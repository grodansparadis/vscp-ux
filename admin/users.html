<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>VSCP admin interface - User maintenance</title>

    <!-- Don't cache the page -->
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />

    <!-- JQuery -->
    <script type="text/javascript" src="../js/jquery/3.1.1/jquery-3.1.1.min.js"></script>

    <!-- Tether -->
    <script type="text/javascript" src="../js/tether/1.3.3/js/tether.min.js"></script>
    
    <!-- Bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../js/bootstrap/3.3.7/css/bootstrap.min.css"> 
    <script type="text/javascript" src="../js/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Bootstrap dialogs -->
    <link rel="stylesheet" href="../js/bootstrap3-dialog/1.34.6/css/bootstrap-dialog.min.css">
    <script type="text/javascript" src="../js/bootstrap3-dialog/1.34.6/js/bootstrap-dialog.min.js"></script>

    <!-- Bootstrap waitingfor dialog -->
    <script type="text/javascript" src="../js/waitingfor.js"></script>

    <!-- Data tables -->
    <link rel="stylesheet" href="../js/datatables/datatables.min.css">
    <script type="text/javascript" src="../js/datatables/datatables.min.js"></script>

    <script src="../js/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

    <!-- Favorite icon -->
    <link rel="icon" href="favicon.ico">

    <!-- VSCP settings -->
    <script type="text/javascript" src="../js/settings.js"></script>
    <!-- VSCP hash calculation -->
    <script type="text/javascript" src="../js/md5.js"></script>
    <!-- VSCP websocket bases library -->
    <script type="text/javascript" src="../js/vscp.js"></script>
    <!-- VSCP admin library -->
    <script type="text/javascript" src="../js/vscpadmin.js"></script>
    <!-- VSCP user library -->
    <script type="text/javascript" src="../js/vscpuser.js"></script>

    <!-- Menu styles -->
    <link rel="stylesheet" type="text/css" href="css/menu.css">
    
    <!-- Boostrap navigation bar helper functions -->
    <script type="text/javascript" src="../js/navBar.js"></script>
    <!-- Navigation bar menu structure -->
    <script type="text/javascript" src="js/menu.js"></script>

    <link rel="stylesheet" type="text/css" href="css/vscp-admin.css">

    <script type="text/javascript">

        var curSelectedVariable;    // Current selected variable
        var table = null;  
        var gindexes;               // Curret selected row(s)
        var editorValue;            // ace editor for value
        var editorNote;             // ace editor for notes 

        // VSCP websocket connection
        var vscpConn = null;

        ///////////////////////////////////////////////////////////////////////////////////////////
        // load ready
        //
        // Wait until the whole website is loaded
        $( document ).ready( function() {
                
            // Show navigation bar menu
            navBarMenu.show( "menu", navBarMenu.content );

            //vscp.admin.setCopyright();
            vscp.admin.setStatus( "<b>Server:</b> no server selected.", false );

            if ( typeof( Storage ) !== "undefined" ) {
                // Server
                if ( null != localStorage.getItem("vscp-url") ) {
                    settings.url = localStorage.getItem("vscp-url");
                }

                vscp.admin.setStatus( settings.url, false );

                // User
                if ( null != localStorage.getItem("vscp-user") ) {
                    settings.user = localStorage.getItem("vscp-user");
                }
                // Password
                if ( null != localStorage.getItem("vscp-password") ) {
                    settings.password = localStorage.getItem("vscp-password");
                }
                // AuthDomain
                if ( null != localStorage.getItem("vscp-authdomain") ) {
                    settings.authdomain = localStorage.getItem("vscp-authdomain");
                }
            } 
            else {
                // No Web Storage support.
                vscp.admin.setStatus( settings.url, false );
            }   

            table = $('#userTable').DataTable( {
                select: 'single',
                "order": [[ 1, 'asc' ], [ 2, 'asc' ]],
                "lengthChange": true,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                dom: 'l Bfrtip',
                "oTableTools": {
                    "sRowSelect": "single"
                },
                buttons: [
                    'colvis','copy', 'csv','excel', 'pdf','print'
                ],
                columns: [
                    { title: "Ordinal", visible: false, searchable: false  },
                    { title: "User id", sort: true },
                    { title: "Username" },
                    { title: "Password", visible: false, searchable: false  },
                    { title: "Full Name" },                    
                    { title: "Filter", visible: false, searchable: false  },
                    { title: "Mask", visible: false, searchable: false  },
                    { title: "Rights", visible: false, searchable: false  },
                    { title: "Allowed Remotes", visible: false, searchable: false  },
                    { title: "Allowed Events", visible: false, searchable: false  },                    
                    { title: "Note" },                
                ],
                
            });

            ///////////////////////////////////////////////////////////////////////////////////////////////
            // select row
            //

            table.on( 'select', function ( e, dt, type, indexes ) {
                
                if ( type === 'row' ) {

                    gindexes = indexes;
                    var row = table.rows( indexes ).data(); 
                    var data = row[0]; 

                    curSelectedVariable = data;
                    
                    showFullInfo( data );
                }
                
            });

            

            ///////////////////////////////////////////////////////////////////////////////////////////////
            // deselect row
            //

            table.on( 'deselect', function ( e, dt, type, indexes ) 
            {
                if ( type === 'row' ) {
                    $('#userdata').html("");
                }
            });
 
            ///////////////////////////////////////////////////////////////////////////////////////////////
            // Double click row
            //
            
            $('#userTable tbody').on( 'dblclick', 'tr', function () 
            {
                editUser();              
            });

            
        
            ///////////////////////////////////////////////////////////////////////////////////////////////
            // Credential handling
            //

            if ( typeof( Storage ) !== "undefined" ) {

                // Server
                if ( null != localStorage.getItem("vscp-url") ) {                    
                    settings.url = localStorage.getItem("vscp-url");
                }

                vscp.admin.setStatus( settings.url, false );

                // User
                if ( null != localStorage.getItem("vscp-user") ) {
                    settings.user = localStorage.getItem("vscp-user");
                }
                // Password
                if ( null != localStorage.getItem("vscp-password") ) {
                    settings.password = localStorage.getItem("vscp-password");
                }
                // AuthDoamin
                if ( null != localStorage.getItem("vscp-token") ) {
                    settings.token = localStorage.getItem("vscp-token");
                }
            } 
            else {
                // No Web Storage support.
                //setConnectInfo( settings.url, false );
            }

            // Create a VSCP websocket
            vscpConn = new vscp.Connection();

            ui.disable();

            // Connect to VSCP server
            vscpConn.connect({

                url: settings.url,
                userName: settings.user,
                password: settings.password,
                authdomain: settings.authdomain,

                onSuccess: function( conn ) {

                    // Start receiving VSCP events
                    vscpConn.start({

                        onSuccess: function( conn ) {

                            if ( 0 == vscpConn.userId ) {
                                // Show conect status
                                vscp.admin.setStatus( vscpConn.url, true );

                                fetchUsers(); 
                            }
                            else {
                                // Warn user
                                BootstrapDialog.alert({
                                    title: 'ERROR',
                                    type: BootstrapDialog.TYPE_DANGER,
                                    message: 'You must be logged in as the admin user to handle user information.'
                                });
                            }

                        },

                        onError: function( conn ) {

                            // Show connect status
                            vscp.admin.setStatus( vscpConn.url, false );

                            // Warn user
                            BootstrapDialog.alert({
                                title: 'ERROR',
                                type: BootstrapDialog.TYPE_DANGER,
                                message: 'Unable to connect to server.'
                            });

                            // Enable the user interface
                            ui.enable();

                        },

                        onConnError: function( conn ) {

                            // Show connect status
                            vscp.admin.setStatus( vscpConn.url, false );

                            // Warn user
                            BootstrapDialog.alert({
                                type: BootstrapDialog.TYPE_WARNING,
                                message: 'Connection error.'
                            });
                            
                            // Enable the user interface
                            ui.enable();
                        },

                    });

                },

                onError: function( conn ) {
                    BootstrapDialog.alert({
                        message: 'Could not establish a connection or connection lost. Reload page to try again.'
                    });
                    /*setTimeout(function () {
                        location.reload()
                    }, 2000);*/
                }

            });       

        }); // onLoad

        ///////////////////////////////////////////////////////////////////////////////////////////
        // ui enable/disable
        //
        // User interface data
        //

        var ui = {
            enable: function() {
                $( "#ui :input" ).attr( "disabled", false );
            },

            disable: function() {
                $( "#ui :input" ).attr( "disabled", true );
            }
        };

        ///////////////////////////////////////////////////////////////////////////////////////////////
        // showFullInfo
        //

        function showFullInfo( data )
        {
            var user_html_content = "<h4>User data</h4>" +
                                "<table class='table table-striped table-hover table-condensed'>" +
                                "<tr><td> <b>Ordinal: </b></td><td>" + data[0] + "</td><tr>" +
                                "<tr><td> <b>User id: </b></td><td>" + data[1] + "</td><tr>" +
                                "<tr class='success'><td> <b>User name: </b></td><td>" + data[2] + "</td><tr>" +
                                "<tr><td> <b>Password: </b></td><td>" + data[3] + "</td><tr>" +
                                "<tr><td> <b>Full name: </b></td><td>" + data[4] + "</td><tr>" +
                                "<tr><td> <b>Filter: </b></td><td>" + data[5] + "</td><tr>" +
                                "<tr><td> <b>Mask: </b></td><td>" + data[6] + "</td><tr>" +
                                "<tr><td> <b>Rights: </b></td><td>" + data[7] + "</td><tr>" +
                                "<tr><td> <b>Allowed Remotes: </b></td><td>" + data[8] + "</td><tr>" +
                                "<tr><td> <b>Allowed Events: </b></td><td>" + data[9] + "</td><tr>" +
                                "<tr><td> <b>Note: </b></td><td>" + data[10] + "</td><tr>" +
                                "</table>";
            $('#userdata').html( user_html_content );
        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // fetchVariables
        //

        function fetchUsers() {
            
            // Clear table
            table.clear().draw();

            // Fetch users
            vscp.user.fetchUsers( 

                // Success
                function() {

                    var idx = 0;
                    vscp.user.userinfo.forEach( function( u ) { 
                        //alert( u[vscp.user.records.NOTE] );
                        table.row.add( [
                                    idx++,
                                    u[vscp.user.records.ID],
                                    u[vscp.user.records.NAME],
                                    u[vscp.user.records.PASSWORD], 
                                    u[vscp.user.records.FULLNAME],
                                    u[vscp.user.records.FILTER],
                                    u[vscp.user.records.MASK],
                                    u[vscp.user.records.RIGHTS],
                                    u[vscp.user.records.REMOTES],
                                    u[vscp.user.records.EVENTS],                                     
                                    vscp.b64DecodeUnicode(u[vscp.user.records.NOTE]) 
                                ] ).draw( false ); 

                    });    

                    // Enable the user interface
                    ui.enable();      
                },
                // Error
                function() {
                                    
                    // Enable the user interface
                    ui.enable();
                                    
                    // Warn user
                    BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Unable to  get users.'
                    });
                }
            );     
        }

        

        ///////////////////////////////////////////////////////////////////////////////////////////
        // deleteUser
        //

        function deleteUser() 
        {
            var table = $('#userTable').DataTable();
            var data = table.rows('.selected').data();

            if ( undefined == data[0] ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: 'A row must be selected for a user to be deleted'
                });
                return;
            }

            var userid =  data[0][1];
            var name =  data[0][2];

            if ( parseInt( userid ) <= 0 ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: "Can\'t remove internal users" 
                });
                return;
            }


            BootstrapDialog.confirm( { 
                title: 'WARNING',
                message: 'Are you sure that the user \'' + name + '\' with userid = ' + userid + ' should be deleted?', 
                type: BootstrapDialog.TYPE_WARNING,
                callback: function( result ) {
                    if ( result ) {

                        ui.disable();
                        vscpConn.writeVar({

                            name:   "vscp.user.delete",
                            type:   vscp.constants.varTypes.STRING.toString(),
                            value:  name, //vscp.b64EncodeUnicode( name ),

                            onSuccess: function( conn ) {
                                ui.enable();
                                // Fetch users
                                fetchUsers();
                                // Clear full info area
                                $('#userdata').html("");
                            },

                            onError: function( conn ) {
                                BootstrapDialog.alert({
                                    type: BootstrapDialog.TYPE_WARNING,
                                    message: 'Failed to save variable!'
                                });                                
                                ui.enable();
                            }

                        });
                    }
                }
            });

        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // editUser
        //
        // Show the edit dialog
        //

        function editUser() 
        {
            var table = $('#userTable').DataTable();
            var data = table.rows('.selected').data();

            if ( undefined == data[0] ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: 'A row must be selected for a user to be edited'
                });
                return;
            }

            editDialog( data[0] );
        }
        
        ///////////////////////////////////////////////////////////////////////////////////////////
        // editDialog
        //
        // Show modal to edit variable
        //

        function editDialog( data ) 
        {
            // Can not change stock variables
            if ( parseInt( data[ 1 ] ) <= 0  ) {
                BootstrapDialog.alert({
                        title: 'WARNING',
                        type: BootstrapDialog.TYPE_WARNING,
                        message: 'Internal users can not be edited.'
                });
                return;
            }

            $('#editdlg_header').html("Edit VSCP system user");
            
            $('#dlgedit_ordinal').val( data[ 0 ] );
            $('#dlgedit_username').val( data[ 2 ] );
            $('#dlgedit_password').val( data[ 3 ] );
            $('#dlgedit_password2').val( data[ 3 ] );
            $('#dlgedit_fullname').val( data[ 4 ] );
            $('#dlgedit_filter').val( data[ 5 ] );
            $('#dlgedit_mask').val( data[ 6 ] );
            $('#dlgedit_rights').val( data[ 7 ] );
            $('#dlgedit_remotes').val( data[ 8 ] );
            $('#dlgedit_events').val( data[ 9 ] );
            $('#dlgedit_note').val( data[ 10 ] );

            $('#dlgEditUser').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveEditResult
        //
        // Save results from edit dialog
        //

        var saveEditResult = function() {

            ui.disable();

            // If this was a add operation
            if ( $('#dlgedit_ordinal').val() == -1 ) {
                saveAddResult();
                return;
            }

            var user = $('#dlgedit_username').val() + ";" +
                        $('#dlgedit_password').val() + ";" +
                        $('#dlgedit_fullname').val() + ";" +
                        $('#dlgedit_filter').val() + ";" +
                        $('#dlgedit_mask').val() + ";" +
                        $('#dlgedit_rights').val() + ";" +
                        $('#dlgedit_remotes').val() + ";" +
                        $('#dlgedit_events').val() + ";" +
                        vscp.b64EncodeUnicode( $('#dlgedit_note').val() );           

            vscpConn.writeVar({ 

                name: "vscp.user." + $('#dlgedit_ordinal').val(),
                value: user,
                type: vscp.constants.varTypes.STRING.toString(),

                onSuccess: function( conn ) {
                    
                    vscpConn.readVar({

                        name: "vscp.user." + $('#dlgedit_ordinal').val(),

                        onSuccess: function( conn, options ) {  

                            // Add to array
                            var items = options.value.split(";"); 
                            var row_exist;
                            if ( ( row_exist = isUserInTable( items[1] ) ) < 0 ) {
                                
                                BootstrapDialog.alert({
                                    title: 'ERROR',
                                    type: BootstrapDialog.TYPE_DANGER,
                                    message: 'User ' + items[1] + ' not found in table. He/she should be there. Report this error!'
                                });

                            }
                            else {
                                
                                // Replace data of row
                                // userid;name;password;fullname;filter;mask;rights;remotes;events;note
                                table.cell( row_exist, 1).data( items[0] );     // Userid
                                table.cell( row_exist, 2).data( items[1] );     // Username
                                table.cell( row_exist, 3).data( items[2] );     // Password 
                                table.cell( row_exist, 4).data( items[3] );     // Full Name

                                table.cell( row_exist, 5).data( items[4] );     // Filter
                                table.cell( row_exist, 6).data( items[5] );     // Mask
                                table.cell( row_exist, 7).data( items[6] );     // Rights
                                table.cell( row_exist, 8).data( items[7] );     // Allowed Remotes
                                table.cell( row_exist, 9).data( items[8] );     // Allowed EVENTS
                                table.cell( row_exist, 10).data( vscp.b64DecodeUnicode( items[9] ) );    // Note

                                var row = table.rows( gindexes ).data(); 
                                var data = row[0]; 

                                curSelectedVariable = data;
                    
                                showFullInfo( data );
                            }

                        },
                        onError: function( conn ) {
                            BootstrapDialog.alert({
                                title: 'ERROR',
                                type: BootstrapDialog.TYPE_DANGER,
                                message: 'Failed to read back user data ' + options.name
                            });
                        }
                    });

                },

                onError: function( conn ) {
                    
                    BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Failed to save variable!'
                    });

                    ui.enable();
                }
            });                 

        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // duplicateUser
        //
        // Duplicate selected user
        //

        function duplicateUser() 
        {
            var table = $('#userTable').DataTable();
            var row = table.rows('.selected').data();            

            if ( undefined == row[0] ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: 'A row must be selected for a user to be duplicated'
                });
                return;
            }

            var data = row[0];
            
            $('#editdlg_header').html("Duplicate existing VSCP system user");            
            
            $('#dlgedit_ordinal').val("-1");
            $('#dlgedit_username').val(data[2]+"_new");
            $('#dlgedit_password').val(data[3]);
            $('#dlgedit_password2').val(data[3]);
            $('#dlgedit_fullname').val(data[4]);
            $('#dlgedit_filter').val(data[5]);
            $('#dlgedit_mask').val(data[6]);
            $('#dlgedit_rights').val(data[7]);
            $('#dlgedit_remotes').val(data[8]);
            $('#dlgedit_events').val(data[9]);
            $('#dlgedit_note').val(data[10]);

            addDialog();

        };

        //////////////////////////////////////////////////////////////////////////////////////////
        // addUser
        //

        function addUser() 
        {
            $('#editdlg_header').html("Add new VSCP system user");            
            
            $('#dlgedit_ordinal').val("-1");
            $('#dlgedit_username').val("");
            $('#dlgedit_password').val("");
            $('#dlgedit_password2').val("");
            $('#dlgedit_fullname').val("");
            $('#dlgedit_filter').val("0,0,0,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00");
            $('#dlgedit_mask').val("0,0,0,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00");
            $('#dlgedit_rights').val("0/0/0/0/0/0/0/0");
            $('#dlgedit_remotes').val("*");
            $('#dlgedit_events').val("*:*");
            $('#dlgedit_note').val("");

            addDialog();
        }

        

        ///////////////////////////////////////////////////////////////////////////////////////////
        // addDialog
        //
        // Show modal for adding data
        //

        function addDialog() 
        { 
            $('#dlgEditUser').modal();
        };

        

        ///////////////////////////////////////////////////////////////////////////////////////////
        // isUserInTable
        //

        function isUserInTable( name ) {
            
            for ( i=0; i<table.rows().count(); i++ ) {
                
                if ( name.toLowerCase() == $('#userTable').dataTable({bRetrieve: true}).fnGetData(i)[2].toLowerCase()  ) {
                    return i;
                }
            }

            // Not found
            return -1;
        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveAddResult
        //
        // Save results from add dialog
        //

        var saveAddResult = function() {

            var user = $('#dlgedit_username').val() + ";" +
                        $('#dlgedit_password').val() + ";" +
                        $('#dlgedit_fullname').val() + ";" +
                        $('#dlgedit_filter').val() + ";" +
                        $('#dlgedit_mask').val() + ";" +
                        $('#dlgedit_rights').val() + ";" +
                        $('#dlgedit_remotes').val() + ";" +
                        $('#dlgedit_events').val() + ";" +
                        vscp.b64EncodeUnicode( $('#dlgedit_note').val() );           

            vscpConn.writeVar({ 

                name: "vscp.user.add",
                value: user,
                type: vscp.constants.varTypes.STRING.toString(),

                onSuccess: function( conn ) {
                    
                    fetchUsers();

                    ui.enable();

                },

                onError: function( conn ) {
                    
                    BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Failed to add user!'
                    });

                    ui.enable();
                }
            });
        };

    </script>

</head>
<body>

    <!-- **************************************************************************************-->
    <!--                              Modal to edit variable                                   -->
    <!-- **************************************************************************************-->
    <div id="dlgEditUser" class="modal fade" role="dialog">
        
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="editdlg_header" class="modal-title">Edit VSCP user</h4>
                </div>

                <div class="modal-body">
   
                    <form role="form">

                        <input type="hidden" class="form-control" id="dlgedit_ordinal"  >

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Username</label>
                            <input type="text" class="form-control" id="dlgedit_username"  >
                            <span class="help-block">Username for user (must be unique).</span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Password</label>
                            <input type="password" class="form-control" id="dlgedit_password"  >
                            <span class="help-block">Password for user.</span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Repeat password</label>
                            <input type="password" class="form-control" id="dlgedit_password2"  >
                            <span class="help-block">Repeat password for user.</span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Full name</label>
                            <input type="text" class="form-control" id="dlgedit_fullname"  >
                            <span class="help-block">Full name of user.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Filter</label>                    
                            <div class="input-group">                                
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_filter">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-success btn-sm">Set filter</button>
                                </div>
                            </div>
                            <span class="help-block">Set user filter.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Mask</label>                    
                            <div class="input-group">                                
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_mask">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-success btn-sm">Set mask</button>
                                </div>
                            </div>
                            <span class="help-block">Set user mask.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Rights</label>                    
                            <div class="input-group">                                
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_rights">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-success btn-sm">Set rights</button>
                                </div>
                            </div>
                            <span class="help-block">Set user rights.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Remotes</label>                    
                            <div class="input-group">                                
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_remotes">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-success btn-sm">Set remotes</button>
                                </div>
                            </div>
                            <span class="help-block">Set allowed remotes this user can log in from ("*" is all).</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Events</label>                    
                            <div class="input-group">                                
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_events">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-success btn-sm">Set events</button>
                                </div>
                            </div>
                            <span class="help-block">Set allowed events this used can send ("*" is all).</span>
                        </div>
                     
                        <div class="form-group">
                            <label for="note"><span class="glyphicon glyphicon-asterisk"></span> note</label>
                            <textarea class="form-control" rows="6" id="dlgedit_note" placeholder="Enter value"></textarea>
                            <span class="help-block">Enter an optional description for the user. Presented as HTML.</span>
                        </div>
                        
                    </form>
                </div>
                <div class="modal-footer">  
                    <button type="button" class="btn btn-success btn-lg" data-dismiss="modal" onclick="saveEditResult()">Save</button>                  
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>

    </div>


    <!-- **********************************************************************************************************************-->
    <!--                                                      Menu                                                             -->
    <!-- **********************************************************************************************************************-->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">
                <img src="../images/logo/vscp_new.png" class="img-thumbnail" width="120" alt="vscp logo" /></a>
            </div>
            <div id="menu">
            </div>
        </div>
    </nav>

    <!-- **********************************************************************************************************************-->
    <!--                                                    Table-area                                                        -->
    <!-- **********************************************************************************************************************-->
    <div class="container-fluid">
        <h1>VSCP system users</h1>

        <div class="container-fluid">            
            <div class="row">
                
            </div>
            <div class="row">                
                <div class="col-sm-2">
                    
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-primary col-sm-12" onclick="fetchUsers();">
                            <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> Fetch users
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="editUser();">
                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Edit user
                        </button>
                    </div>
                    </p>
                    
                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="addUser();">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add user
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="deleteUser();">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete user
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="duplicateUser()">
                            <span class="glyphicon glyphicon-duplicate" aria-hidden="true"></span> Duplicate user
                        </button>
                    </div>
                    </p>
       
                </div>
                
                <div class="col-sm-9">
                    <table id="userTable"  class="table table-striped table-bordered table-hover display nowrap" cellspacing="50" width="100%"></table>
                </div>
                <div class="col-sm-1"></div>
            </div>

            
            <div class="row">
                <div class="col-sm-2"> </div>                
                <div class="col-sm-9" >
                    <p>
                        <div id="userdata"/>
                    </p> 
                </div>         
                <div class="col-sm-1"></div>
            </div>

            <br>
            <div class="row">
                <div class="col-sm-2"></div>                
                <div class="col-sm-9"></div>         
                <div class="col-sm-1"></div>
            </div>     

        </div>
        
    </div>
    
    <!-- <div id="copyright-info" /> -->

    <footer>
        <div id="status-footer"/>
    </footer>
    
</body>
</html>
