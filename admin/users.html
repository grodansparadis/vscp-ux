<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VSCP admin interface - User maintenance</title>

    <!-- Don't cache the page -->
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />

    <!-- JQuery -->
    <script type="text/javascript" src="../js/jquery/3.2.1/jquery-3.2.1.min.js"></script>

    <!-- Tether -->
    <script type="text/javascript" src="../js/tether/1.3.3/js/tether.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="../js/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/custom.css">
    <script type="text/javascript" src="../js/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Bootstrap dialogs -->
    <link rel="stylesheet" href="../js/bootstrap3-dialog/1.34.6/css/bootstrap-dialog.min.css">
    <script type="text/javascript" src="../js/bootstrap3-dialog/1.34.6/js/bootstrap-dialog.min.js"></script>

    <!-- Bootstrap waitingfor dialog -->
    <script type="text/javascript" src="../js/waitingfor.js"></script>

    <!-- Data tables -->
    <link rel="stylesheet" href="../js/datatables/datatables.min.css">
    <script type="text/javascript" src="../js/datatables/datatables.min.js"></script>

    <script src="../js/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

    <!-- Favorite icon -->
    <link rel="icon" href="../favicon.ico">

    <!-- VSCP settings -->
    <script type="text/javascript" src="../js/settings.js"></script>
    <!-- VSCP hash calculation -->
    <script type="text/javascript" src="../js/md5.js"></script>
    <!-- VSCP encryption/decryption -->
    <script type="text/javascript" src="../js/aes-js-3.1.0/index.js"></script>
    <!-- VSCP websocket bases library -->
    <script type="text/javascript" src="../js/vscp.js"></script>
    <!-- VSCP admin library -->
    <script type="text/javascript" src="../js/vscpadmin.js"></script>
    <!-- VSCP user library -->
    <script type="text/javascript" src="../js/vscpuser.js"></script>

    <!-- Menu styles -->
    <link rel="stylesheet" type="text/css" href="css/menu.css">

    <!-- Boostrap navigation bar helper functions -->
    <script type="text/javascript" src="../js/navBar.js"></script>
    <!-- Navigation bar menu structure -->
    <script type="text/javascript" src="js/menu.js"></script>

    <link rel="stylesheet" type="text/css" href="css/vscp-admin.css">

    <script type="text/javascript">

        var curSelectedVariable;    // Current selected variable
        var table = null;
        var gindexes;               // Curret selected row(s)
        var editorValue;            // ace editor for value
        var editorNote;             // ace editor for notes

        // VSCP websocket connection
        var vscpConn = null;

        ///////////////////////////////////////////////////////////////////////////////////////////
        // load ready
        //
        // Wait until the whole website is loaded
        $( document ).ready( function() {

            // Show navigation bar menu
            navBarMenu.show( "menu", navBarMenu.content );

            //vscp.admin.setCopyright();
            vscp.admin.setStatus( "<b>Server:</b> no server selected.", false );

            if ( typeof( Storage ) !== "undefined" ) {
                // Server
                if ( null != localStorage.getItem("vscp-url") ) {
                    settings.url = localStorage.getItem("vscp-url");
                }

                vscp.admin.setStatus( settings.url, false );

                // User
                if ( null != localStorage.getItem("vscp-user") ) {
                    settings.user = localStorage.getItem("vscp-user");
                }
                // Password
                if ( null != localStorage.getItem("vscp-password") ) {
                    settings.password = localStorage.getItem("vscp-password");
                }
                // AuthDomain
                if ( null != localStorage.getItem("vscp-authdomain") ) {
                    settings.authdomain = localStorage.getItem("vscp-authdomain");
                }
            }
            else {
                // No Web Storage support.
                vscp.admin.setStatus( settings.url, false );
            }

            table = $('#userTable').DataTable( {
                select: 'single',
                "order": [[ 1, 'asc' ], [ 2, 'asc' ]],
                "lengthChange": true,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                dom: 'l Bfrtip',
                "oTableTools": {
                    "sRowSelect": "single"
                },
                buttons: [
                    'colvis','copy', 'csv','excel', 'pdf','print'
                ],
                columns: [
                    { title: "Ordinal", visible: false, searchable: false  },
                    { title: "User id", sort: true },
                    { title: "Username" },
                    { title: "Password", visible: false, searchable: false  },
                    { title: "Full Name" },
                    { title: "Filter", visible: false, searchable: false  },
                    { title: "Mask", visible: false, searchable: false  },
                    { title: "Rights", visible: false, searchable: false  },
                    { title: "Allowed Remotes", visible: false, searchable: false  },
                    { title: "Allowed Events", visible: false, searchable: false  },
                    { title: "Note" },
                ],

            });

            ///////////////////////////////////////////////////////////////////////////////////////////////
            // select row
            //

            table.on( 'select', function ( e, dt, type, indexes ) {

                if ( type === 'row' ) {

                    gindexes = indexes;
                    var row = table.rows( indexes ).data();
                    var data = row[0];

                    curSelectedVariable = data;

                    showFullInfo( data );
                }

            });



            ///////////////////////////////////////////////////////////////////////////////////////////////
            // deselect row
            //

            table.on( 'deselect', function ( e, dt, type, indexes )
            {
                if ( type === 'row' ) {
                    $('#userdata').html("");
                }
            });

            ///////////////////////////////////////////////////////////////////////////////////////////////
            // Double click row
            //

            $('#userTable tbody').on( 'dblclick', 'tr', function ()
            {
                editUser();
            });


            ///////////////////////////////////////////////////////////////////////////////////////////////
            // Credential handling
            //

            if ( typeof( Storage ) !== "undefined" ) {

                // Server
                if ( null != localStorage.getItem("vscp-url") ) {
                    settings.url = localStorage.getItem("vscp-url");
                }

                vscp.admin.setStatus( settings.url, false );

                // User
                if ( null != localStorage.getItem("vscp-user") ) {
                    settings.user = localStorage.getItem("vscp-user");
                }
                // Password
                if ( null != localStorage.getItem("vscp-password") ) {
                    settings.password = localStorage.getItem("vscp-password");
                }
                // AuthDoamin
                if ( null != localStorage.getItem("vscp-token") ) {
                    settings.token = localStorage.getItem("vscp-token");
                }
            }
            else {
                // No Web Storage support.
                //setConnectInfo( settings.url, false );
            }

            // Create a VSCP websocket
            vscpConn = new vscp.Connection();

            ui.disable();

            // Connect to VSCP server
            vscpConn.connect({

                url: settings.url,
                userName: settings.user,
                password: settings.password,
                authdomain: settings.authdomain,
                vscpkey: settings.vscpkey,

                onSuccess: function( conn ) {

                    // Start receiving VSCP events
                    vscpConn.start({

                        onSuccess: function( conn ) {

                            if ( 0 == vscpConn.userId ) {
                                // Show conect status
                                vscp.admin.setStatus( vscpConn.url, true );

                                fetchUsers();
                            }
                            else {
                                // Warn user
                                BootstrapDialog.alert({
                                    title: 'ERROR',
                                    type: BootstrapDialog.TYPE_DANGER,
                                    message: 'You must be logged in as the admin user to handle user information.'
                                });
                            }

                        },

                        onError: function( conn ) {

                            // Show connect status
                            vscp.admin.setStatus( vscpConn.url, false );

                            // Warn user
                            BootstrapDialog.alert({
                                title: 'ERROR',
                                type: BootstrapDialog.TYPE_DANGER,
                                message: 'Unable to connect to server.'
                            });

                            // Enable the user interface
                            ui.enable();

                        },

                        onConnError: function( conn ) {

                            // Show connect status
                            vscp.admin.setStatus( vscpConn.url, false );

                            // Warn user
                            BootstrapDialog.alert({
                                type: BootstrapDialog.TYPE_WARNING,
                                message: 'Connection error.'
                            });

                            // Enable the user interface
                            ui.enable();
                        },

                    });

                },

                onError: function( conn ) {
                    BootstrapDialog.alert({
                        message: 'Could not establish a connection or connection lost. Reload page to try again.'
                    });
                    /*setTimeout(function () {
                        location.reload()
                    }, 2000);*/
                }

            });

        }); // onLoad

        ///////////////////////////////////////////////////////////////////////////////////////////
        // ui enable/disable
        //
        // User interface data
        //

        var ui = {
            enable: function() {
                $( "#ui :input" ).attr( "disabled", false );
            },

            disable: function() {
                $( "#ui :input" ).attr( "disabled", true );
            }
        };

        ///////////////////////////////////////////////////////////////////////////////////////////////
        // showFullInfo
        //

        function showFullInfo( data )
        {
            var remotes = data[8].trim();
            var events = data[9].trim();

            if ( 0 == remotes.length ) remotes = "*";

            if ( 0 == events.length ) events = "*:*";

            var user_html_content = "<h4>User data</h4>" +
                                "<table class='table table-striped table-hover table-condensed'>" +
                                "<tr class='success'><td> <b>Ordinal: </b></td><td>" + data[0] + "</td><tr>" +
                                "<tr class='success'><td> <b>User id: </b></td><td>" + data[1] + "</td><tr>" +
                                "<tr class='success'><td> <b>User name: </b></td><td>" + data[2] + "</td><tr>" +
                                "<tr class='success'><td> <b>Password: </b></td><td>" + data[3] + "</td><tr>" +
                                "<tr class='success'><td> <b>Full name: </b></td><td>" + data[4] + "</td><tr>" +
                                "<tr class='success'><td> <b>Filter: </b></td><td>" + data[5] + "</td><tr>" +
                                "<tr class='success'><td> <b>Mask: </b></td><td>" + data[6] + "</td><tr>" +
                                "<tr class='success'><td> <b>Rights: </b></td><td>" + data[7] + "</td><tr>" +
                                "<tr class='success'><td> <b>Allowed Remotes: </b></td><td>" + remotes + "</td><tr>" +
                                "<tr class='success'><td> <b>Allowed Events: </b></td><td>" + events + "</td><tr>" +
                                "<tr class='success'><td> <b>Note: </b></td><td>" + data[10] + "</td><tr>" +
                                "</table>";
            $('#userdata').html( user_html_content );
        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // fetchUsers
        //

        function fetchUsers() {

            waitingDialog.show('Fetching users...', {dialogSize: 'xm', progressType: 'warning'});

            // Clear extended data
            $('#userdata').html("");

            // Clear table
            table.clear().draw();

            // Fetch users
            vscp.user.fetchUsers(

                // Success
                function() {

                    var idx = 0;
                    vscp.user.userinfo.forEach( function( u ) {

                        //alert( u[vscp.user.records.NOTE] );
                        table.row.add( [
                                    idx++,
                                    u[vscp.user.records.ID],
                                    u[vscp.user.records.NAME],
                                    u[vscp.user.records.PASSWORD],
                                    u[vscp.user.records.FULLNAME],
                                    u[vscp.user.records.FILTER],
                                    u[vscp.user.records.MASK],
                                    u[vscp.user.records.RIGHTS],
                                    u[vscp.user.records.REMOTES],
                                    u[vscp.user.records.EVENTS],
                                    vscp.b64DecodeUnicode(u[vscp.user.records.NOTE])
                                ] ).draw( false );

                    });

                    // Enable the user interface
                    ui.enable();

                    waitingDialog.hide();
                },
                // Error
                function() {

                    // Enable the user interface
                    ui.enable();

                    waitingDialog.hide();

                    // Warn user
                    BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Unable to  get users.'
                    });
                }
            );
        }



        ///////////////////////////////////////////////////////////////////////////////////////////
        // deleteUser
        //

        function deleteUser()
        {
            var table = $('#userTable').DataTable();
            var data = table.rows('.selected').data();

            if ( undefined == data[0] ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: 'A row must be selected for a user to be deleted'
                });
                return;
            }

            var userid =  data[0][1];
            var name =  data[0][2];

            if ( parseInt( userid ) <= 0 ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: "Can\'t remove internal users"
                });
                return;
            }


            BootstrapDialog.confirm( {
                title: 'WARNING',
                message: 'Are you sure that the user \'' + name + '\' with userid = ' + userid + ' should be deleted?',
                type: BootstrapDialog.TYPE_WARNING,
                callback: function( result ) {
                    if ( result ) {

                        ui.disable();
                        vscpConn.writeVar({

                            name:   "vscp.user.delete",
                            type:   vscp.constants.varTypes.STRING.toString(),
                            value:  name, //vscp.b64EncodeUnicode( name ),

                            onSuccess: function( conn ) {
                                ui.enable();
                                // Fetch users
                                fetchUsers();
                                // Clear full info area
                                $('#userdata').html("");
                            },

                            onError: function( conn ) {
                                BootstrapDialog.alert({
                                    type: BootstrapDialog.TYPE_WARNING,
                                    message: 'Failed to save variable!'
                                });
                                ui.enable();
                            }

                        });
                    }
                }
            });

        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // editUser
        //
        // Show the edit dialog
        //

        function editUser()
        {
            var table = $('#userTable').DataTable();
            var data = table.rows('.selected').data();

            if ( undefined == data[0] ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: 'A row must be selected for a user to be edited'
                });
                return;
            }

            editDialog( data[0] );
        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // editDialog
        //
        // Show modal to edit variable
        //

        function editDialog( data )
        {
            // Can not change stock variables
            if ( parseInt( data[ 1 ] ) <= 0  ) {
                BootstrapDialog.alert({
                        title: 'WARNING',
                        type: BootstrapDialog.TYPE_WARNING,
                        message: 'Internal users can not be edited.'
                });
                return;
            }

            $('#editdlg_header').html("Edit VSCP system user");

            var remotes = data[ 8 ].trim();
            var events = data[ 9 ].trim();

            if ( 0 == remotes.length ) remotes = "*";
            if ( 0 == events.length ) events = "*:*";

            // Can not change username
            $("#dlgedit_username").prop("readonly", true);

            $('#dlgedit_ordinal').val( data[ 0 ] );
            $('#dlgedit_username').val( data[ 2 ] );
            $('#dlgedit_password1').val( data[ 3 ] );
            $('#dlgedit_password2').val( data[ 3 ] );
            $('#dlgedit_fullname').val( data[ 4 ] );
            $('#dlgedit_filter').val( data[ 5 ] );
            $('#dlgedit_mask').val( data[ 6 ] );
            $('#dlgedit_rights').val( data[ 7 ] );
            $('#dlgedit_remotes').val( remotes );
            $('#dlgedit_events').val( events );
            $('#dlgedit_note').val( data[ 10 ] );

            doPasswordOnKeyUp();

            $('#dlgEditUser').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveEditResult
        //
        // Save results from edit dialog
        //

        var saveEditResult = function()
        {

            if ( $("#pw1grp").hasClass("has-error") ) {

                BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'The two password fields must have the same content.'
                });;

                return;
            }

            ui.disable();

            // If this was a add operation
            if ( $('#dlgedit_ordinal').val() == -1 ) {
                saveAddResult();
                return;
            }

            var user = $('#dlgedit_username').val() + ";" +
                        $('#dlgedit_password').val() + ";" +
                        $('#dlgedit_fullname').val() + ";" +
                        $('#dlgedit_filter').val() + ";" +
                        $('#dlgedit_mask').val() + ";" +
                        $('#dlgedit_rights').val() + ";" +
                        $('#dlgedit_remotes').val() + ";" +
                        $('#dlgedit_events').val() + ";" +
                        vscp.b64EncodeUnicode( $('#dlgedit_note').val() );

            vscpConn.writeVar({

                name: "vscp.user." + $('#dlgedit_ordinal').val(),
                value: user,
                type: vscp.constants.varTypes.STRING.toString(),

                onSuccess: function( conn ) {

                    vscpConn.readVar({

                        name: "vscp.user." + $('#dlgedit_ordinal').val(),

                        onSuccess: function( conn, options ) {

                            // Add to array
                            var items = options.value.split(";");
                            var row_exist;
                            if ( ( row_exist = isUserInTable( items[1] ) ) < 0 ) {

                                BootstrapDialog.alert({
                                    title: 'ERROR',
                                    type: BootstrapDialog.TYPE_DANGER,
                                    message: 'User ' + items[1] + ' not found in table. He/she should be there. Report this error!'
                                });

                            }
                            else {

                                // Replace data of row
                                // userid;name;password;fullname;filter;mask;rights;remotes;events;note
                                table.cell( row_exist, 1).data( items[0] );     // Userid
                                table.cell( row_exist, 2).data( items[1] );     // Username
                                table.cell( row_exist, 3).data( items[2] );     // Password
                                table.cell( row_exist, 4).data( items[3] );     // Full Name

                                table.cell( row_exist, 5).data( items[4] );     // Filter
                                table.cell( row_exist, 6).data( items[5] );     // Mask
                                table.cell( row_exist, 7).data( items[6] );     // Rights
                                table.cell( row_exist, 8).data( items[7] );     // Allowed Remotes
                                table.cell( row_exist, 9).data( items[8] );     // Allowed EVENTS
                                table.cell( row_exist, 10).data( vscp.b64DecodeUnicode( items[9] ) );    // Note

                                var row = table.rows( gindexes ).data();
                                var data = row[0];

                                curSelectedVariable = data;

                                showFullInfo( data );
                            }

                            $('#dlgEditUser').modal('hide');

                        },
                        onError: function( conn ) {
                            BootstrapDialog.alert({
                                title: 'ERROR',
                                type: BootstrapDialog.TYPE_DANGER,
                                message: 'Failed to read back user data ' + options.name
                            });

                            $('#dlgEditUser').modal('hide');
                        }
                    });

                },

                onError: function( conn ) {

                    BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Failed to save variable!'
                    });

                    $('#dlgEditUser').modal('hide');
                    ui.enable();
                }
            });

        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // duplicateUser
        //
        // Duplicate selected user
        //

        function duplicateUser()
        {
            var table = $('#userTable').DataTable();
            var row = table.rows('.selected').data();

            if ( undefined == row[0] ) {
                BootstrapDialog.alert({
                    title: 'WARNING',
                    type: BootstrapDialog.TYPE_WARNING,
                    message: 'A row must be selected for a user to be duplicated'
                });
                return;
            }

            var data = row[0];

            $('#editdlg_header').html("Duplicate existing VSCP system user");

            // Can change username
            $("#dlgedit_username").prop("readonly", false);

            $('#dlgedit_ordinal').val("-1");
            $('#dlgedit_username').val(data[2]+"_new");
            $('#dlgedit_password1').val(data[3]);
            $('#dlgedit_password2').val(data[3]);
            $('#dlgedit_fullname').val(data[4]);
            $('#dlgedit_filter').val(data[5]);
            $('#dlgedit_mask').val(data[6]);
            $('#dlgedit_rights').val(data[7]);
            $('#dlgedit_remotes').val(data[8]);
            $('#dlgedit_events').val(data[9]);
            $('#dlgedit_note').val(data[10]);

            addDialog();

        };

        //////////////////////////////////////////////////////////////////////////////////////////
        // addUser
        //

        function addUser()
        {
            $('#editdlg_header').html("Add new VSCP system user");

            // Can change username
            $("#dlgedit_username").prop("readonly", false);

            $('#dlgedit_ordinal').val("-1");
            $('#dlgedit_username').val("");
            $('#dlgedit_password1').val("");
            $('#dlgedit_password2').val("");
            $('#dlgedit_fullname').val("");
            $('#dlgedit_filter').val("0,0,0,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00");
            $('#dlgedit_mask').val("0,0,0,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00");
            $('#dlgedit_rights').val("0/0/0/0/0/0/0/0");
            $('#dlgedit_remotes').val("*");
            $('#dlgedit_events').val("*:*");
            $('#dlgedit_note').val("");

            addDialog();
        }



        ///////////////////////////////////////////////////////////////////////////////////////////
        // addDialog
        //
        // Show modal for adding data
        //

        function addDialog()
        {
            $('#dlgEditUser').modal();
        };



        ///////////////////////////////////////////////////////////////////////////////////////////
        // isUserInTable
        //

        function isUserInTable( name ) {

            for ( i=0; i<table.rows().count(); i++ ) {

                if ( name.toLowerCase() == $('#userTable').dataTable({bRetrieve: true}).fnGetData(i)[2].toLowerCase()  ) {
                    return i;
                }
            }

            // Not found
            return -1;
        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveAddResult
        //
        // Save results from add dialog
        //

        var saveAddResult = function() {

            if ( 0 == $('#dlgedit_username').val().length ) {

                BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Username can not be empty.'
                });;

                return;
            }

            if ( $("#pw1grp").hasClass("has-error") || $("#pw2grp").hasClass("has-error") ) {

                BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'The two password fields must have the same content.'
                });;

                return;
            }

            var user = $('#dlgedit_username').val() + ";" +
                        $('#dlgedit_password1').val() + ";" +
                        $('#dlgedit_fullname').val() + ";" +
                        $('#dlgedit_filter').val() + ";" +
                        $('#dlgedit_mask').val() + ";" +
                        $('#dlgedit_rights').val() + ";" +
                        $('#dlgedit_remotes').val() + ";" +
                        $('#dlgedit_events').val() + ";" +
                        vscp.b64EncodeUnicode( $('#dlgedit_note').val() );

            vscpConn.writeVar({

                name: "vscp.user.add",
                value: user,
                type: vscp.constants.varTypes.STRING.toString(),

                onSuccess: function( conn ) {

                    fetchUsers();

                    $('#dlgEditUser').modal('hide');
                    ui.enable();

                },

                onError: function( conn ) {

                    BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Failed to add user!'
                    });

                    $('#dlgEditUser').modal('hide');
                    ui.enable();
                }
            });
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // filterDialog
        //
        // Show modal for setting filter
        //

        function filterDialog( filter )
        {
            items = filter.split(',');

            $('#dlgfilter_vscppriority').val(items[0]);
            $('#dlgfilter_vscpclass').val(items[1]);
            $('#dlgfilter_vscptype').val(items[2]);
            $('#dlgfilter_vscpguid').val(items[3]);

            $('#dlgFilter').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveFilterResult
        //

        function saveFilterResult()
        {
            var filterguid = $('#dlgfilter_vscpguid').val();
            filterguid = filterguid.trim();
            if ( '-' == filterguid ) {
                filterguid = "00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00";
            }

            var filter = $('#dlgfilter_vscppriority').val() + ',' +
                            $('#dlgfilter_vscpclass').val() + ',' +
                            $('#dlgfilter_vscptype').val() + ',' +
                            filterguid;
            $(dlgedit_filter).val( filter );
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // maskDialog
        //
        // Show modal for setting mask
        //

        function maskDialog( filter )
        {
            items = filter.split(',');

            $('#dlgmask_vscppriority').val(items[0]);
            $('#dlgmask_vscpclass').val(items[1]);
            $('#dlgmask_vscptype').val(items[2]);
            $('#dlgmask_vscpguid').val(items[3]);

            $('#dlgMask').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveMaskResult
        //

        function saveMaskResult()
        {
            var maskguid = $('#dlgmask_vscpguid').val();
            maskguid = maskguid.trim();
            if ( '-' == maskguid ) {
                maskguid = "00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00";
            }

            var mask = $('#dlgmask_vscppriority').val() + ',' +
                            $('#dlgmask_vscpclass').val() + ',' +
                            $('#dlgmask_vscptype').val() + ',' +
                            maskguid;
            $(dlgedit_mask).val( mask );
        };

        //////////////////////////////////////////////////////////////////////////////////////////
        // doPasswordOnKeyUp
        //

        function doPasswordOnKeyUp()
        {
            //$(dlgedit_password2).val( $(dlgedit_password1).val() );
            if ( $('#dlgedit_password1').val() != $('#dlgedit_password2').val() ) {
                $("#pw1grp").addClass("has-error has-feedback");
                $("#pw2grp").addClass("has-error has-feedback");
            }
            else {
                $("#pw1grp").removeClass("has-error");
                $("#pw2grp").removeClass("has-error");
            }
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // rightsDialog
        //
        // Show modal for setting of user rights
        //

        function rightsDialog( rights )
        {
            items = rights.split('/');

            // ************************
            // * * * Init. byte 0 * * *
            // ************************
            if ( parseInt( items[0] ) & 0x80 ) {
                 $('#byte0_7').prop('checked', true);
            }
            else {
                $('#byte0_7').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x40 ) {
                 $('#byte0_6').prop('checked', true);
            }
            else {
                $('#byte0_6').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x20 ) {
                 $('#byte0_5').prop('checked', true);
            }
            else {
                $('#byte0_5').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x10 ) {
                 $('#byte0_4').prop('checked', true);
            }
            else {
                $('#byte0_4').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x08 ) {
                 $('#byte0_3').prop('checked', true);
            }
            else {
                $('#byte0_3').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x04 ) {
                 $('#byte0_2').prop('checked', true);
            }
            else {
                $('#byte0_2').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x02 ) {
                 $('#byte0_1').prop('checked', true);
            }
            else {
                $('#byte0_1').prop('checked', false);
            }

            if ( parseInt( items[0] ) & 0x01 ) {
                 $('#byte0_0').prop('checked', true);
            }
            else {
                $('#byte0_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 1 * * *
            // ************************
            if ( parseInt( items[1] ) & 0x80 ) {
                 $('#byte1_7').prop('checked', true);
            }
            else {
                $('#byte1_7').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x40 ) {
                 $('#byte1_6').prop('checked', true);
            }
            else {
                $('#byte1_6').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x20 ) {
                 $('#byte1_5').prop('checked', true);
            }
            else {
                $('#byte1_5').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x10 ) {
                 $('#byte1_4').prop('checked', true);
            }
            else {
                $('#byte1_4').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x08 ) {
                 $('#byte1_3').prop('checked', true);
            }
            else {
                $('#byte1_3').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x04 ) {
                 $('#byte1_2').prop('checked', true);
            }
            else {
                $('#byte1_2').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x02 ) {
                 $('#byte1_1').prop('checked', true);
            }
            else {
                $('#byte1_1').prop('checked', false);
            }

            if ( parseInt( items[1] ) & 0x01 ) {
                 $('#byte1_0').prop('checked', true);
            }
            else {
                $('#byte1_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 2 * * *
            // ************************
            if ( parseInt( items[2] ) & 0x80 ) {
                 $('#byte2_7').prop('checked', true);
            }
            else {
                $('#byte2_7').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x40 ) {
                 $('#byte2_6').prop('checked', true);
            }
            else {
                $('#byte2_6').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x20 ) {
                 $('#byte2_5').prop('checked', true);
            }
            else {
                $('#byte2_5').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x10 ) {
                 $('#byte2_4').prop('checked', true);
            }
            else {
                $('#byte2_4').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x08 ) {
                 $('#byte2_3').prop('checked', true);
            }
            else {
                $('#byte2_3').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x04 ) {
                 $('#byte2_2').prop('checked', true);
            }
            else {
                $('#byte2_2').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x02 ) {
                 $('#byte2_1').prop('checked', true);
            }
            else {
                $('#byte2_1').prop('checked', false);
            }

            if ( parseInt( items[2] ) & 0x01 ) {
                 $('#byte2_0').prop('checked', true);
            }
            else {
                $('#byte2_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 3 * * *
            // ************************
            if ( parseInt( items[3] ) & 0x80 ) {
                 $('#byte3_7').prop('checked', true);
            }
            else {
                $('#byte3_7').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x40 ) {
                 $('#byte3_6').prop('checked', true);
            }
            else {
                $('#byte3_6').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x20 ) {
                 $('#byte3_5').prop('checked', true);
            }
            else {
                $('#byte3_5').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x10 ) {
                 $('#byte3_4').prop('checked', true);
            }
            else {
                $('#byte3_4').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x08 ) {
                 $('#byte3_3').prop('checked', true);
            }
            else {
                $('#byte3_3').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x04 ) {
                 $('#byte3_2').prop('checked', true);
            }
            else {
                $('#byte3_2').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x02 ) {
                 $('#byte3_1').prop('checked', true);
            }
            else {
                $('#byte3_1').prop('checked', false);
            }

            if ( parseInt( items[3] ) & 0x01 ) {
                 $('#byte3_0').prop('checked', true);
            }
            else {
                $('#byte3_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 4 * * *
            // ************************
            if ( parseInt( items[4] ) & 0x80 ) {
                 $('#byte4_7').prop('checked', true);
            }
            else {
                $('#byte4_7').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x40 ) {
                 $('#byte4_6').prop('checked', true);
            }
            else {
                $('#byte4_6').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x20 ) {
                 $('#byte4_5').prop('checked', true);
            }
            else {
                $('#byte4_5').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x10 ) {
                 $('#byte4_4').prop('checked', true);
            }
            else {
                $('#byte4_4').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x08 ) {
                 $('#byte4_3').prop('checked', true);
            }
            else {
                $('#byte4_3').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x04 ) {
                 $('#byte4_2').prop('checked', true);
            }
            else {
                $('#byte4_2').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x02 ) {
                 $('#byte4_1').prop('checked', true);
            }
            else {
                $('#byte4_1').prop('checked', false);
            }

            if ( parseInt( items[4] ) & 0x01 ) {
                 $('#byte4_0').prop('checked', true);
            }
            else {
                $('#byte4_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 5 * * *
            // ************************
            if ( parseInt( items[5] ) & 0x80 ) {
                 $('#byte5_7').prop('checked', true);
            }
            else {
                $('#byte5_7').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x40 ) {
                 $('#byte5_6').prop('checked', true);
            }
            else {
                $('#byte5_6').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x20 ) {
                 $('#byte5_5').prop('checked', true);
            }
            else {
                $('#byte5_5').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x10 ) {
                 $('#byte5_4').prop('checked', true);
            }
            else {
                $('#byte5_4').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x08 ) {
                 $('#byte5_3').prop('checked', true);
            }
            else {
                $('#byte5_3').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x04 ) {
                 $('#byte5_2').prop('checked', true);
            }
            else {
                $('#byte5_2').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x02 ) {
                 $('#byte5_1').prop('checked', true);
            }
            else {
                $('#byte5_1').prop('checked', false);
            }

            if ( parseInt( items[5] ) & 0x01 ) {
                 $('#byte5_0').prop('checked', true);
            }
            else {
                $('#byte5_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 6 * * *
            // ************************
            if ( parseInt( items[6] ) & 0x80 ) {
                 $('#byte6_7').prop('checked', true);
            }
            else {
                $('#byte6_7').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x40 ) {
                 $('#byte6_6').prop('checked', true);
            }
            else {
                $('#byte6_6').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x20 ) {
                 $('#byte6_5').prop('checked', true);
            }
            else {
                $('#byte6_5').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x10 ) {
                 $('#byte6_4').prop('checked', true);
            }
            else {
                $('#byte6_4').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x08 ) {
                 $('#byte6_3').prop('checked', true);
            }
            else {
                $('#byte6_3').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x04 ) {
                 $('#byte6_2').prop('checked', true);
            }
            else {
                $('#byte6_2').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x02 ) {
                 $('#byte6_1').prop('checked', true);
            }
            else {
                $('#byte6_1').prop('checked', false);
            }

            if ( parseInt( items[6] ) & 0x01 ) {
                 $('#byte6_0').prop('checked', true);
            }
            else {
                $('#byte6_0').prop('checked', false);
            }

            // ************************
            // * * * Init. byte 7 * * *
            // ************************
            if ( parseInt( items[7] ) & 0x80 ) {
                 $('#byte7_7').prop('checked', true);
            }
            else {
                $('#byte7_7').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x40 ) {
                 $('#byte7_6').prop('checked', true);
            }
            else {
                $('#byte7_6').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x20 ) {
                 $('#byte7_5').prop('checked', true);
            }
            else {
                $('#byte7_5').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x10 ) {
                 $('#byte7_4').prop('checked', true);
            }
            else {
                $('#byte7_4').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x08 ) {
                 $('#byte7_3').prop('checked', true);
            }
            else {
                $('#byte7_3').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x04 ) {
                 $('#byte7_2').prop('checked', true);
            }
            else {
                $('#byte7_2').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x02 ) {
                 $('#byte7_1').prop('checked', true);
            }
            else {
                $('#byte7_1').prop('checked', false);
            }

            if ( parseInt( items[7] ) & 0x01 ) {
                 $('#byte7_0').prop('checked', true);
            }
            else {
                $('#byte7_0').prop('checked', false);
            }

            $('#dlgRights').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveRightsResult
        //

        function saveRightsResult()
        {
            var byte = [0,0,0,0,0,0,0,0];

            // Byte 0
            $("input:checkbox[name=byte0]:checked").each( function() {
                byte[0] += parseInt( $(this).val() );
            });

            // Byte 1
            $("input:checkbox[name=byte1]:checked").each( function() {
                byte[1] += parseInt( $(this).val() );
            });

            // Byte 2
            $("input:checkbox[name=byte2]:checked").each( function() {
                byte[2] += parseInt( $(this).val() );
            });

            // Byte 3
            $("input:checkbox[name=byte3]:checked").each( function() {
                byte[3] += parseInt( $(this).val() );
            });

            // Byte 4
            $("input:checkbox[name=byte4]:checked").each( function() {
                byte[4] += parseInt( $(this).val() );
            });

            // Byte 5
            $("input:checkbox[name=byte5]:checked").each( function() {
                byte[5] += parseInt( $(this).val() );
            });

            // Byte 6
            $("input:checkbox[name=byte6]:checked").each( function() {
                byte[6] += parseInt( $(this).val() );
            });

            // Byte 7
            $("input:checkbox[name=byte7]:checked").each( function() {
                byte[7] += parseInt( $(this).val() );
            });

            $('#dlgedit_rights').val(
                byte[0].toString() + "/" +
                byte[1].toString() + "/" +
                byte[2].toString() + "/" +
                byte[3].toString() + "/" +
                byte[4].toString() + "/" +
                byte[5].toString() + "/" +
                byte[6].toString() + "/" +
                byte[7].toString()
            )
        }

        ///////////////////////////////////////////////////////////////////////////////////////////
        // remotesDialog
        //
        // Show modal for setting of user allowed remotes
        //

        function remotesDialog( remotes )
        {
            // Empty listbox
            $('#selRemotes').empty();

            // Fill with remotes
            items = remotes.split('/');
            $.each(items, function(key, value) {
                value = value.trim();
                if ( 0 == value.length ) value = "*";
                $('#selRemotes')
                    .append($('<option>', { value : key })
                    .text(value));
                });

            // mark the first option as selected
            $("#selRemotes").prop("selectedIndex", 0);

            $('#dlgRemotes').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // addRemote
        //

        function addRemote( key )
        {
            var remote = prompt("Enter remote IP", "*");

            // IP test expression to test for valid IPv4 / IPv6 address
            var iptest_expression = /((^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$))/;

            if ( ( '*' == remote ) || ( iptest_expression.test( remote ) ) ) {
                if (remote != null) {
                    $('#selRemotes').append($("<option></option>")
                    .attr("value", key )
                    .text(remote) );
                }
            }
            else {
                BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Bad IP address!'
                });
            }


        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // deleteRemote
        //

        function deleteRemote() {
            $('#selRemotes').find('option:selected').remove();
            // mark the first option as selected
            $("#selRemotes").prop("selectedIndex", 0);
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveRemotesResult
        //

        function saveRemotesResult()
        {
            var count = $('#selRemotes option').length;
            var remotes = "";

            $('#selRemotes option').each( function ( index ) {
                remotes += $(this).text();
                if ( index != (count-1) ) remotes += "/";
            });

            if ( 0 == remotes.length ) {
                remotes = "*";
            }

            $('#dlgedit_remotes').val(remotes);

        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // eventsDialog
        //
        // Show modal for setting of user allowed events
        //

        function eventsDialog( events )
        {
            // Empty listbox
            $('#selEvents').empty();

            // Fill with remotes
            items = events.split('/');
            $.each(items, function(key, value) {
                value = value.trim();
                $('#selEvents')
                    .append($('<option>', { value : key })
                    .text(value));
            });

            // mark the first option as selected
            $("#selEvents").prop("selectedIndex", 0);

            $('#dlgEvents').modal();
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // addEvent
        //

        function addEvent( key )
        {
            var event = prompt("Enter event on the form class:type", "*:*");

            // IP test expression to test for valid IPv4 / IPv6 address
            var iptest_expression = /((^\s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))\s*$)|(^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$))/;

            if ( ( '*' == event ) || ( iptest_expression.test( event ) ) ) {
                if (event != null) {
                    $('#selEvents').append($("<option></option>")
                    .attr("value", key )
                    .text(remote) );
                }
            }
            else {
                BootstrapDialog.alert({
                        title: 'ERROR',
                        type: BootstrapDialog.TYPE_DANGER,
                        message: 'Bad event'
                });
            }


        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // deleteEvent
        //

        function deleteEvent() {
            $('#selEvents').find('option:selected').remove();
            // mark the first option as selected
            $("#selEvents").prop("selectedIndex", 0);
        };

        ///////////////////////////////////////////////////////////////////////////////////////////
        // saveEventsResult
        //

        function saveEventsResult()
        {
            var count = $('#selEvents option').length;
            var events = "";

            $('#selEvents option').each( function ( index ) {
                events += $(this).text();
                if ( index != (count-1) ) events += "/";
            });

            if ( 0 == events.length ) {
                events = "*:*";
            }

            $('#dlgedit_events').val(events);

        };

    </script>

</head>
<body>

    <!-- **************************************************************************************-->
    <!--                              Modal to edit variable                                   -->
    <!-- **************************************************************************************-->
    <div id="dlgEditUser" class="modal fade" role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="editdlg_header" class="modal-title">Edit VSCP user</h4>
                </div>

                <div class="modal-body">

                    <form role="form">

                        <input type="hidden" class="form-control" id="dlgedit_ordinal"  >

                        <div class="form-group" >
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Username</label>
                            <input type="text" class="form-control" id="dlgedit_username"  >
                            <span class="help-block">Username for user (must be unique).</span>
                        </div>

                        <div class="form-group" id="pw1grp">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Password</label>
                            <input type="password" class="form-control" id="dlgedit_password1" onkeyup="doPasswordOnKeyUp();"  >
                            <span class="help-block">Password for user.</span>
                        </div>

                        <div class="form-group" id="pw2grp">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Repeat password</label>
                            <input type="password" class="form-control" id="dlgedit_password2" onkeyup="doPasswordOnKeyUp();" >
                            <span class="help-block">Repeat password for user.</span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> Full name</label>
                            <input type="text" class="form-control" id="dlgedit_fullname"  >
                            <span class="help-block">Full name of user.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Filter</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_filter">
                                <div class="input-group-btn">
                                    <button type="button" onclick="filterDialog( $('#dlgedit_filter').val() );" class="btn btn-success btn-sm">Set filter</button>
                                </div>
                            </div>
                            <span class="help-block">Set user filter.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Mask</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_mask">
                                <div class="input-group-btn">
                                    <button type="button" onclick="maskDialog( $('#dlgedit_mask').val() );" class="btn btn-success btn-sm">Set mask</button>
                                </div>
                            </div>
                            <span class="help-block">Set user mask.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Rights</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_rights">
                                <div class="input-group-btn">
                                    <button type="button" onclick="rightsDialog( $('#dlgedit_rights').val() );" class="btn btn-success btn-sm">Set rights</button>
                                </div>
                            </div>
                            <span class="help-block">Set user rights.</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Remotes</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_remotes">
                                <div class="input-group-btn">
                                    <button type="button" onclick="remotesDialog( $('#dlgedit_remotes').val() );" class="btn btn-success btn-sm">Set remotes</button>
                                </div>
                            </div>
                            <span class="help-block">Set remotes this user can log in from ("*" is all).</span>
                        </div>

                        <div class="form-group">
                            <label for="dlgtype"><span class="glyphicon glyphicon-asterisk"></span> Events</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgedit_events">
                                <div class="input-group-btn">
                                    <button type="button" onclick="eventsDialog( $('#dlgedit_events').val() );" class="btn btn-success btn-sm">Set events</button>
                                </div>
                            </div>
                            <span class="help-block">Set events this user can send ("*" is all).</span>
                        </div>

                        <div class="form-group">
                            <label for="note"><span class="glyphicon glyphicon-asterisk"></span> note</label>
                            <textarea class="form-control" rows="6" id="dlgedit_note" placeholder="Enter value"></textarea>
                            <span class="help-block">Enter an optional description for the user. Presented as HTML.</span>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg" onclick="saveEditResult()">Save</button>
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>

    </div>


    <!-- **************************************************************************************-->
    <!--                              Modal to edit filter                                   -->
    <!-- **************************************************************************************-->
    <div id="dlgFilter" class="modal fade" role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="filterdlg_header" class="modal-title">Edit VSCP user filter</h4>
                </div>

                <div class="modal-body">

                    <form role="form">

                        <div class="form-group">
                            <label for="priority"><span class="glyphicon glyphicon-asterisk"></span> priority</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgfilter_vscppriority">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-success dropdown-toggle"
                                                data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">priority <span class="caret"></span></button>
                                    <ul id="dlgfilter_prioritydd" class="dropdown-menu dropdown-menu-right">
                                        <li>Very Very High (0)</li>
                                        <li>Very High (1)</li>
                                        <li>High (2)</li>
                                        <li>Above normal (3)</li>
                                        <li>Normal (4)</li>
                                        <li>Low (5)</li>
                                        <li>Very Low (6)</li>
                                        <li>Very very Low (7)</li>
                                    </ul>
                                </div>
                            </div>
                            <span class="help-block">If user should receive all events regardless of priority set this value
                                to zero for a don't care. If user just should see events of a certain priority set to 0xFF and
                                set the priority of interest in the corresponding filter. </span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> VSCP Class</label>
                            <input type="text" class="form-control" id="dlgfilter_vscpclass"  >
                            <span class="help-block">If user should receive all events regardless of VSCP class set this value
                                to zero for a don't care. If user shuld just see events of a certain VSC class set to 0xFFFF and
                                set the VSCP class of interest in the corresponding filter.
                            </span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> VSCP Type</label>
                            <input type="text" class="form-control" id="dlgfilter_vscptype"  >
                            <span class="help-block">If user should receive all events regardless of VSCP type set this value
                                to zero for a don't care. If user shuld just see events of a certain VSCP type set to 0xFFFF and
                                set the VSCP type of interest in the corresponding filter.
                            </span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> GUID</label>
                            <input type="text" class="form-control" id="dlgfilter_vscpguid"  >
                            <span class="help-block">Set to all zeros if user should see events from all devices and interfaces. Set to
                                'FF:FF:FF:FF:FF:FF:FF:FF:FF:FF:FF:FF:FF:FF:00:00 if user should just see events from a specific interface.
                                Then enter the interface GUID in the corresponding GUID filter.
                                You can enter a single '-' for a filter with all zeros.
                            </span>
                        </div>



                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg" data-dismiss="modal" onclick="saveFilterResult()">Save</button>
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>




    <!-- **************************************************************************************-->
    <!--                              Modal to edit mask                                   -->
    <!-- **************************************************************************************-->
    <div id="dlgMask" class="modal fade" role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="filterdlg_header" class="modal-title">Edit VSCP user mask</h4>
                </div>

                <div class="modal-body">

                    <form role="form">

                        <div class="form-group">
                            <label for="priority"><span class="glyphicon glyphicon-asterisk"></span> priority</label>
                            <div class="input-group">
                                <input readonly type="text" class="form-control" aria-label="..." id="dlgmask_vscppriority">
                            </div>
                            <span class="help-block">Set priority (0 (high)-7 (low)).</span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> VSCP Class</label>
                            <input type="text" class="form-control" id="dlgmask_vscpclass"  >
                            <span class="help-block">Normally you set a Level I or Level II VSCP class here that
                                 the user is allowed to receive. In that case set the corresponding mask to all ones,
                                 or 0xffff. Data can be enetered as a deciaml integer or a hexadecimal integer (preced number with '0x'
                                 in the ater case).
                            </span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> VSCP Type</label>
                            <input type="text" class="form-control" id="dlgmask_vscptype"  >
                            <span class="help-block">Normally you set a Level I or Level II VSCP type here that
                                 the user is allowed to receive. In that case set the correspnding mask to all ones,
                                 or 0xffff. Data can be enetered as a deciaml integer or a hexadecimal integer (preced number with '0x'
                                  in the later case).
                            </span>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> GUID</label>
                            <input type="text" class="form-control" id="dlgmask_vscpguid"  >
                            <span class="help-block">Set the GUID filter here. If you enter a specific GUID and set all
                                byte of the mask GUID to FF (all ones) events will only be received form that device.
                                The GUID should always be give as hex bytes without the preceding '0x'. You can enter a single '-'
                                for a filter with all zeros.
                            </span>
                        </div>



                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg" data-dismiss="modal" onclick="saveMaskResult()">Save</button>
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>


    <!-- **************************************************************************************-->
    <!--                              Modal to edit rights                                     -->
    <!-- **************************************************************************************-->
    <div id="dlgRights" class="modal fade" role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="filterdlg_header" class="modal-title">Edit VSCP user rights</h4>
                </div>

                <div class="modal-body">

                    <form role="form">

                        <div class="form-group">
                            <label  for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte 0 (MSB)</label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_7" class="form-control-xs" value="128"> <span id="bt0_7">Bit 7</span></label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_6" class="form-control-xs" value="64"> <span id="bt0_6">Bit 6</label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_5" class="form-control-xs" value="32"> <span id="bt0_5">Bit 5</span></label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_4" class="form-control-xs" value="16"> <span id="bt0_4">Bit 4</span></label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_3" class="form-control-xs" value="8"> <span id="bt0_3">Bit 3</span></label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_2" class="form-control-xs" value="4"> <span id="bt0_2">Bit 2</span></label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_1" class="form-control-xs" value="2"> <span id="bt0_1">Bit 1</span></label><br>
                            <label><input type="checkbox" name="byte0" id="byte0_0" class="form-control-xs" value="1"> <span id="bt0_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  1</label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_7" class="form-control-xs" value="128"> <span id="bt1_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_6" class="form-control-xs" value="64"> <span id="bt1_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_5" class="form-control-xs" value="32"> <span id="bt1_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_4" class="form-control-xs" value="16"> <span id="bt1_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_3" class="form-control-xs" value="8"> <span id="bt1_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_2" class="form-control-xs" value="4"> <span id="bt1_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_1" class="form-control-xs" value="2"> <span id="bt1_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte1" id="byte1_0" class="form-control-xs" value="1"> <span id="bt1_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  2</label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_7" class="form-control-xs" value="128"> <span id="bt2_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_6" class="form-control-xs" value="64"> <span id="bt2_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_5" class="form-control-xs" value="32"> <span id="bt2_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_4" class="form-control-xs" value="16"> <span id="bt2_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_3" class="form-control-xs" value="8"> <span id="bt2_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_2" class="form-control-xs" value="4"> <span id="bt2_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_1" class="form-control-xs" value="2"> <span id="bt2_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte2" id="byte2_0" class="form-control-xs" value="1"> <span id="bt2_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  3</label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_7" class="form-control-xs" value="128"> <span id="bt3_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_6" class="form-control-xs" value="64"> <span id="bt3_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_5" class="form-control-xs" value="32"> <span id="bt3_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_4" class="form-control-xs" value="16"> <span id="bt3_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_3" class="form-control-xs" value="8"> <span id="bt3_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_2" class="form-control-xs" value="4"> <span id="bt3_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_1" class="form-control-xs" value="2"> <span id="bt3_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte3" id="byte3_0" class="form-control-xs" value="1"> <span id="bt3_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  4</label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_7" class="form-control-xs" value="128"> <span id="bt4_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_6" class="form-control-xs" value="64"> <span id="bt4_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_5" class="form-control-xs" value="32"> <span id="bt4_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_4" class="form-control-xs" value="16"> <span id="bt4_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_3" class="form-control-xs" value="8"> <span id="bt4_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_2" class="form-control-xs" value="4"> <span id="bt4_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_1" class="form-control-xs" value="2"> <span id="bt4_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte4" id="byte4_0" class="form-control-xs" value="1"> <span id="bt4_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  5</label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_7" class="form-control-xs" value="128"> <span id="bt5_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_6" class="form-control-xs" value="64"> <span id="bt5_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_5" class="form-control-xs" value="32"> <span id="bt5_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_4" class="form-control-xs" value="16"> <span id="bt5_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_3" class="form-control-xs" value="8"> <span id="bt5_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_2" class="form-control-xs" value="4"> <span id="bt5_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_1" class="form-control-xs" value="2"> <span id="bt5_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte5" id="byte5_0" class="form-control-xs" value="1"> <span id="bt5_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  6</label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_7" class="form-control-xs" value="128"> <span id="bt6_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_6" class="form-control-xs" value="64"> <span id="bt6_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_5" class="form-control-xs" value="32"> <span id="bt6_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_4" class="form-control-xs" value="16"> <span id="bt6_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_3" class="form-control-xs" value="8"> <span id="bt6_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_2" class="form-control-xs" value="4"> <span id="bt6_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_1" class="form-control-xs" value="2"> <span id="bt6_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte6" id="byte6_0" class="form-control-xs" value="1"> <span id="bt6_0">Bit 0</span></label><br>
                        </div>

                        <div class="form-group">
                            <label for="name"><span class="glyphicon glyphicon-asterisk"></span> User rights byte  7 (LSB)</label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_7" class="form-control-xs" value="128"> <span id="bt7_7">Bit 7</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_6" class="form-control-xs" value="64"> <span id="bt7_6">Bit 6</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_5" class="form-control-xs" value="32"> <span id="bt7_5">Bit 5</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_4" class="form-control-xs" value="16"> <span id="bt7_4">Bit 4</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_3" class="form-control-xs" value="8"> <span id="bt7_3">Bit 3</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_2" class="form-control-xs" value="4"> <span id="bt7_2">Bit 2</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_1" class="form-control-xs" value="2"> <span id="bt7_1">Bit 1</span></label><br>
                             <label><input type="checkbox" name="byte7" id="byte7_0" class="form-control-xs" value="1"> <span id="bt7_0">Bit 0</span></label><br>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg" data-dismiss="modal" onclick="saveRightsResult()">Save</button>
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>


    <!-- **************************************************************************************-->
    <!--                              Modal to edit remotes                                     -->
    <!-- **************************************************************************************-->
    <div id="dlgRemotes" class="modal fade" role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="remotesdlg_header" class="modal-title">Edit VSCP user allowed remotes</h4>
                </div>

                <div class="modal-body">

                    <form role="form">

                        <div class="form-group">
                            <label for="remotes"><span class="glyphicon glyphicon-asterisk"></span> allowed remotes</label>
                            <div class="input-group">
                                <select  class="form-control" size="10" id="selRemotes">
                                </select>
                            </div>
                            <br>
                            <button type="button" class="btn btn-error" onclick="addRemote(1)">add </button>
                            <button type="button" class="btn btn-error" onclick="deleteRemote()">delete </button>

                            <span class="help-block">The allowed remotes is a list of IPv4 and/or IPv6 addresses that this user is allowed to
                                login from. A single asterisk tells that the user can log in from anywhere. Wild cards are allowed so that
                                192.168.1.* means a user can login from network 192.168.1.0 </span>
                        </div>


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg" data-dismiss="modal" onclick="saveRemotesResult()">Save</button>
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>

    <!-- **************************************************************************************-->
    <!--                              Modal to edit events                                     -->
    <!-- **************************************************************************************-->
    <div id="dlgEvents" class="modal fade" role="dialog">

        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="eventdlg_header" class="modal-title">Edit VSCP user allowed events</h4>
                </div>

                <div class="modal-body">

                    <form role="form">

                        <div class="form-group">
                            <label for="events"><span class="glyphicon glyphicon-asterisk"></span> allowed events</label>
                            <div class="input-group">
                                <select  class="form-control" size="10" id="selEvents">
                                </select>
                            </div>
                            <br>
                            <button type="button" class="btn btn-error" onclick="addEvent(1)">add </button>
                            <button type="button" class="btn btn-error" onclick="deleteEvent()">delete </button>

                            <span class="help-block">The allowed events is a list of VSCP events this user is allowed to send.
                                Events should be entered as 'class:type' and wildcards are available. For instance '10:*' means the
                                user can send all CLASS1.MEASUREMENT events and in the same manner '*:*' means the user can send all events.
                            </span>
                        </div>


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-lg" data-dismiss="modal" onclick="saveEventsResult()">Save</button>
                    <button type="button" class="btn btn-primary btn-lg" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>


    <!-- **********************************************************************************************************************-->
    <!--                                                      Menu                                                             -->
    <!-- **********************************************************************************************************************-->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">
                <img src="../images/logo/vscp_new.png" class="img-thumbnail" width="120" alt="vscp logo" /></a>
            </div>
            <div id="menu">
            </div>
        </div>
    </nav>

    <!-- **********************************************************************************************************************-->
    <!--                                                    Table-area                                                        -->
    <!-- **********************************************************************************************************************-->
    <div class="container-fluid">
        <h1>VSCP system users</h1>

        <div class="container-fluid">
            <div class="row">

            </div>
            <div class="row">
                <div class="col-sm-2">

                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-primary col-sm-12" onclick="fetchUsers();">
                            <span class="glyphicon glyphicon-repeat" aria-hidden="true"></span> Fetch users
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="editUser();">
                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Edit user
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="addUser();">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add user
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="deleteUser();">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Delete user
                        </button>
                    </div>
                    </p>

                    <p>
                    <div class="input-group col-sm-8">
                        <button type="button" class="btn btn-success col-sm-12" onclick="duplicateUser()">
                            <span class="glyphicon glyphicon-duplicate" aria-hidden="true"></span> Duplicate user
                        </button>
                    </div>
                    </p>

                </div>

                <div class="col-sm-9">
                    <table id="userTable"  class="table table-striped table-bordered table-hover display compact nowrap" cellspacing="50" width="100%"></table>
                </div>
                <div class="col-sm-1"></div>
            </div>


            <div class="row">
                <div class="col-sm-2"> </div>
                <div class="col-sm-9" >
                    <p>
                        <div id="userdata"/>
                    </p>
                </div>
                <div class="col-sm-1"></div>
            </div>

            <br>
            <div class="row">
                <div class="col-sm-2"></div>
                <div class="col-sm-9"></div>
                <div class="col-sm-1"></div>
            </div>

        </div>

    </div>

    <!-- <div id="copyright-info" /> -->

    <footer>
        <div id="status-footer"/>
    </footer>

</body>
</html>
