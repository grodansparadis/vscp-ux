<!DOCTYPE html>
<!--
	//
	// VSCP rest interface test
	// Copyright (C) 2012-2017 Ake Hedman, Grodans Paradis AB
	// <akhe@grodansparadis.com>
	//
	// Licence:
	// The MIT License (MIT)
	// [OSI Approved License]
	//
	// The MIT License (MIT)
	//
	// Copyright (c) 2012-2017 Paradise of the Frog/Grodans Paradis AB
	//
	// Permission is hereby granted, free of charge, to any person obtaining a copy
	// of this software and associated documentation files (the "Software"), to deal
	// in the Software without restriction, including without limitation the rights
	// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	// copies of the Software, and to permit persons to whom the Software is
	// furnished to do so, subject to the following conditions:
	//
	// The above copyright notice and this permission notice shall be included in
	// all copies or substantial portions of the Software.
	//
	// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	// THE SOFTWARE.
	//
	// Alternative licenses for VSCP & Friends may be arranged by contacting
	// Grodans Paradis AB at info@grodansparadis.com, http://www.grodansparadis.com
	//
-->
<html>

<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta charset="UTF-8">
    <title>VSCP REST interface demo</title>

    <!-- Don't cache the page -->
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
</head>

<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="../index.html">
                    <img src="../images/logo/vscp_new.png" class="img-thumbnail" width="100" alt="vscp logo" /></a>
            </div>
            <div id="menu">
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <h3>VSCP REST interface demo code</h3>

        <p>
            This demo demonstrates the VSCP daemon REST interface functionality. The VSCP daemon REST interface is documented
            <a href="http://www.vscp.org/docs/vscpd/doku.php?id=vscp_daemon_vscp_daemon_rest_interface">here</a> and you can find the code for this example on <a href="https://github.com/grodansparadis/vscp-ux">GitHub.</a>
        </p>
        <p>
            Open a session (Open REST session) and possible define a server (set Server) before you start, to work with the other available menu items.
        </p>
        <br>
        <p>
            <b>Tip</b> Open the console log window of your browser to see status from this demo as it use log functionality for info about what is done under the hood.
            <p>
                <hr>
                <p id="host">Host: </p>
                <p id="sessionkey">Sessionkey: </p>
                <p id="nevents"> </p>
                <font size="2" color="green">
                    <p id="events"> </p>
                </font>
                <font size="2" color="blue">
                    <p id="log"> </p>
                </font>
                <br /><br />
                <hr /> Copyright &copy; 2000-2017 <a href="http://www.grodansparadis.com">Grodans Paradis AB (Paradise of the Frog)</a>
    </div>

    <!-- Settings -->
    <script type="text/javascript" src="../js/settings.js"></script>

    <!-- JQuery -->
    <script type="text/javascript" src="../js/jquery/3.2.1/jquery-3.2.1.min.js"></script>

    <!-- Bootstrap -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../js/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/custom.css">
    <script type="text/javascript" src="../js/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- VSCP hash calculation -->
    <script type="text/javascript" src="../js/md5.js"></script>
    <!-- VSCP websocket base library -->
    <script type="text/javascript" src="../js/vscp.js"></script>

    <!-- Favorite icon -->
    <link rel="icon" href="../favicon.ico">

    <!-- Boostrap navigation bar helper functions -->
    <script type="text/javascript" src="../js/navbar.js"></script>
    <!-- Navigation bar menu structure -->
    <script type="text/javascript" src="menu.js"></script>

    <script type="text/javascript">

        var VscpSessionKey = ""; // Session key
        var VscpServer = "http://127.0.0.1:8884"; // Host
        var VscpEventCount = 0; // Events in inqueue
        var txtSendEvent = "0,10,6,0,0,-,138,0,255"; // Event sent by send event
        // Filter/Mask to filter just to receive heart beats CLASS1.INFORMATION, Type=9 Node heartbeat
        // both are "priority,class,type,guid"
        var txtVscpFilter = "0x0000,0x14,0x09,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00";
        var txtVscpMask = "0x0000,0xffff,0xffff,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00";

        (function() {
            $(document).ready(function() {

                // Show navigation bar menu
                navBarMenu.show("menu", navBarMenu.content);

                // Show current server settings
                $("#host").html("<b>Host</b>: " + VscpServer);

            });
        })();


        ///////////////////////////////////////////////////////////////////////
        // do_setServer
        //

        var do_setServer = function() {
            VscpServer = window.prompt("Enter URL for server:", "http://127.0.0.1:8884");
            84
            88
            $("#host").html("<b>Host</b>: " + VscpServer);
        }

        ///////////////////////////////////////////////////////////////////////
        // do_open
        //

        var do_open = function() {

            $.ajax({
                url: VscpServer + "/vscp/rest?vscpuser=" + settings.user + "&vscpsecret=" +
                    settings.password + "&format=jsonp&op=1",
                type: "GET",
                jsonpCallback: 'handler',
                cache: true,
                dataType: 'jsonp',
                success: function(response) {
                    // response will be a JavaScript
                    // array of objects
                    console.log("-----------------------------------------------------------");
                    console.log("                         do_open");
                    console.log("-----------------------------------------------------------");
                    console.log("Success = " + response.success);
                    console.log("Code = " + response.code);
                    console.log("Message = " + response.message);
                    console.log("Description = " + response.description);
                    console.log("Sessionkey = " + response.vscpsession);
                    console.log("nEvents = " + response.nEvents);

                    if (response.success) {
                        console.log("Session key assigned to global object " + typeof(response.success));
                        VscpSessionKey = response.vscpsession;
                        $("#sessionkey").html("<b>Sessionkey</b>: <font size='2' color='red'>" +
                            response.vscpsession + "</font>");
                    }
                    else {
                        $("#sessionkey").html("<font size='2' color='red'><b>Failed to connect</b>: " +
                            error + " status:" + xhr.status + "</font>");
                    }

                },
                error: function(xhr, status, error) {
                    console.log(error + " Status:" + xhr.status);
                    $("#sessionkey").html("<font size='2' color='red'><b>Failed to connect (AJAX)</b>: " +
                        "Code = " + response.code +
                        "Message = " + response.message +
                        "Description = " + response.description +
                        "</font>");
                }
            });
        };

        ///////////////////////////////////////////////////////////////////////
        // do_close
        //

        var do_close = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey + '&format=jsonp&op=2',
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_close");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);

                        if (response.success) {
                            console.log("Sessionkey cleared");
                            VscpSessionKey = "";
                            $("#sessionkey").html("<b>Sessionkey</b>: ");
                            $("#nevents").html(" ");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }
        };

        ///////////////////////////////////////////////////////////////////////
        // do_status
        //

        var do_status = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey + '&format=jsonp&op=status',
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_status");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Number of events = " + response.nEvents);

                        if (response.success) {
                            VscpEventCount = response.nEvents;
                            $("#nevents").html("<b>Number of events in queue</b>: " + response.nEvents);
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }
        };

        ///////////////////////////////////////////////////////////////////////
        // printEventData
        //

        var printEventData = function(event) {
            var eventtxt = "<b>Event</b>: <b>Head</b>:" +
                event.head +
                " <b>DateTime</b>:" + event.datetime +
                " <b>Timestamp</b>:" + event.timestamp +
                " <b>Obid</b>:" + event.obid +
                " <b>Class</b>:" + event.vscpclass +
                " <b>Type</b>:" + event.vscptype +
                " <b>SizeData</b>:" + event.sizedata + " <b>Data</b>: ";
            if (0 != event.sizedata) {
                for (var i = 0; i < event.sizedata; i++) {
                    eventtxt += event.data[i] + " ";
                }
            } else {
                eventtxt += "none";
            }

            return eventtxt;
        }

        ///////////////////////////////////////////////////////////////////////
        // do_readEventOne
        //

        var do_readEventOne = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey + '&format=jsonp&op=readevent&count=1',
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {

                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_readEventOne");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);
                        console.log("Count = " + response.count);
                        console.log("Filtered = " + response.filtered);
                        console.log("Errors = " + response.errors);

                        if (response.success && (1 == response.count)) {
                            $("#events").html(printEventData(response.event[0]));
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }
        };

        ///////////////////////////////////////////////////////////////////////
        // do_readEventAll
        //

        var do_readEventAll = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey + '&format=jsonp&op=readevent&count=10000',
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {

                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_readEventAll");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);
                        console.log("Count = " + response.count);
                        console.log("Filtered = " + response.filtered);
                        console.log("Errors = " + response.errors);

                        if (response.success) {
                            if (response.count > 0) {
                                var eventtxt = "";
                                for (var i = 0; i < response.count; i++) {
                                    eventtxt += printEventData(response.event[i]) + "<br>";
                                }
                                $("#events").html(eventtxt);
                            } else {
                                $("#events").html(" ");
                                $("#nevents").html("It looks like there is no events to read.");
                            };
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_sendEvent
        //

        var do_sendEvent = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=sendevent&vscpevent=' + txtSendEvent,
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_sendEvent");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("event sent");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_setFilter
        //

        var do_setFilter = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=setfilter&vscpfilter=' + txtVscpFilter +
                        '&vscpmask=' + txtVscpMask,
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_setFilter");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("Mask set");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_clrFilter
        //

        var do_clrFilter = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=setfilter&vscpfilter=' +
                        "0,0,0,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00" +
                        '&vscpmask=' +
                        "0,0,0,00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00",
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_clrFilter");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("Mask set");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_clrQueue
        //

        var do_clrQueue = function() {

            if (VscpSessionKey.length > 0) {

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=clearqueue',
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_clrQueue");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("Mask set");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_sendMeasurement
        //

        var do_sendMeasurement = function() {

            if (VscpSessionKey.length > 0) {

                var txtValue =
                    window.prompt("Send CLASS2.MEASUREMENT_FLOAT. Type=6 (temperature) i degrees Celsius:", "23.98");

                var now = new Date();
                var now_utc = new Date( now.getUTCFullYear(),
                                            now.getUTCMonth(),
                                            now.getUTCDate(),
                                            now.getUTCHours(),
                                            now.getUTCMinutes(),
                                            now.getUTCSeconds(),
                                            now.getMilliseconds() );

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=measurement&value=' + txtValue +
                        '&datetime=' + now_utc.toISOString() +
                        '&guid=""' +        // GUID (use GUID of interface)
                        '&type=6' +         // Temperature
                        '&level=2' +        // Level II
                        '&sensoridx=2' +    // Sensor number 2
                        '&unit=1' +         // Unit = 1 Degrees Celsius
                        '&zone=22' +        // Zone = 22
                        '&subzone=33',      // Sub Zone = 33
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {

                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_sendMeasurement");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("OK Variable written");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_createVariable
        //

        var do_createVariable = function() {

            if (VscpSessionKey.length > 0) {

                var txtVariableName = window.prompt("Name of variable to create:", "test");
                if (null == txtVariableName) return;
                var txtVariableType = window.prompt("Type:", "string");
                if (null == txtVariableType) return;
                var txtVariableValue = window.prompt("Value:", "This is a new string");
                if (null == txtVariableValue) return;
                var txtVariableNote = window.prompt("Note:", "A base64 encoded note about this variable.");
                if (null == txtVariableNote) return;
                var txtVariableAccessRight = window.prompt("Access-rights:", "777");
                if (null == txtVariableAccessRight) return;
                var txtVariablePersistent = window.prompt("Persistent (true/false):", "false");
                if (null == txtVariablePersistent) return;

                // The value should be base64 encoded for 'string-types'
                if ((txtVariableType.toUpperCase() == "STRING") ||
                    (txtVariableType == "1") ||
                    (txtVariableType.toUpperCase() == "BLOB") ||
                    (txtVariableType == "16") ||
                    (txtVariableType.toUpperCase() == "MIME") ||
                    (txtVariableType == "100") ||
                    (txtVariableType.toUpperCase() == "HTML") ||
                    (txtVariableType == "101") ||
                    (txtVariableType.toUpperCase() == "JAVASCRIPT") ||
                    (txtVariableType == "102") ||
                    (txtVariableType.toUpperCase() == "JSON") ||
                    (txtVariableType == "103") ||
                    (txtVariableType.toUpperCase() == "XML") ||
                    (txtVariableType == "104") ||
                    (txtVariableType.toUpperCase() == "SQL") ||
                    (txtVariableType == "105") ||
                    (txtVariableType.toUpperCase() == "LUA") ||
                    (txtVariableType == "201") ||
                    (txtVariableType.toUpperCase() == "LUARES") ||
                    (txtVariableType == "202") ||
                    (txtVariableType.toUpperCase() == "UXTYPE1") ||
                    (txtVariableType == "300")) {
                    txtVariableValue = vscp.b64EncodeUnicode(txtVariableValue);
                }


                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=createvar&variable=' + txtVariableName +
                        '&value=' + txtVariableValue +
                        '&type=' + txtVariableType +
                        '&note=' + vscp.b64EncodeUnicode(txtVariableNote) +
                        '&accessright=' + txtVariableAccessRight +
                        '&persistent=' + txtVariablePersistent,
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_createVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("OK Variable written");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_readVariable
        //

        var do_readVariable = function() {

            if (VscpSessionKey.length > 0) {

                var txtVariableName = window.prompt("Name of variable to read:", "test");

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=readvar&variable=' + txtVariableName,
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_readVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);
                        console.log("Variable name = " + response.varname);
                        console.log("Variable type = " + response.vartype);
                        console.log("Variable type code = " + response.vartypecode);
                        console.log("Variable percistence = " + response.varpersistence);
                        console.log("Variable user = " + response.varuser);
                        console.log("Variable access-rights = " + response.varaccessright);
                        console.log("Variable last-change = " + response.varlastchange);
                        console.log("Variable value = " + response.varvalue);
                        console.log("Variable note = " + response.varnote);

                        if (response.success) {
                            $("#log").html(response.varname + " = " + response.varvalue +
                                "<br>Type = " + response.vartype +
                                "<br>Typecode = " + response.vartypecode +
                                "<br>Peristence = " + response.varpersistence +
                                "<br>User = " + response.varuser +
                                "<br>Access-rights = " + response.varaccessright.toString(16) +
                                "<br>Last-change = " + response.varlastchange +
                                "<br>Note = " + response.varnote);
                        } else {
                            $("#log").html("Unable to read variable");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("do_readVariable:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };

        ///////////////////////////////////////////////////////////////////////
        // do_writeVariable
        //

        var do_writeVariable = function() {

            if (VscpSessionKey.length > 0) {

                var txtVariableName = window.prompt("Name of variable to write:", "test");
                var txtVariableValue = window.prompt("New value (BASE64 encoded for string types):", "");

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=writevar&variable=' + txtVariableName +
                        '&value=' + encodeURIComponent(txtVariableValue),
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_writeVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("OK Variable written");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };



        ///////////////////////////////////////////////////////////////////////
        // do_deleteVariable
        //

        var do_deleteVariable = function() {

            if (VscpSessionKey.length > 0) {

                var txtVariableName = window.prompt("Name of variable to delete:", "test");
                if (null == txtVariableName) return;

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=deletevar&variable=' + txtVariableName,
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_deleteVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);

                        if (response.success) {
                            $("#events").html("OK Variable deleted");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };



        ///////////////////////////////////////////////////////////////////////
        // printVariableData
        //

        var printVariableData = function(variable, bLong) {

            var vartxt = "<b>Variable</b>: <b>Name</b>:" + variable.varname +
                " <b>Type</b>:" + variable.vartype +
                " <b>Typecode</b>:" + variable.vartypecode +
                " <b>Persistence</b>:" + variable.varpersistence +
                " <b>User</b>:" + variable.varuser +
                " <b>Access-rights</b>:" + variable.varaccessright +
                " <b>Last-change</b>:" + variable.varlastchange;

            if (true === bLong) {
                vartxt += "<br><b>Value</b>:" + variable.varvalue;
                vartxt += "<br><b>Note</b>:" + variable.varnote;
                vartxt += "<br>-----------------------------------------------------------------------------";
            }

            return vartxt;
        }



        ///////////////////////////////////////////////////////////////////////
        // do_listVariables
        //

        var do_listVariables = function() {

            if (VscpSessionKey.length > 0) {

                $("#events").html("");

                var txtRegEx = window.prompt("Regular expression (leave blank to select all):", "");
                if (null == txtRegEx) txtRegEx = "(.*)";

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=listvar&listlong=false&regex=' + encodeURIComponent(txtRegEx),
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_listVariables");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);
                        console.log("Count = " + response.count);
                        console.log("Errors = " + response.errors);

                        if (response.success) {
                            if (response.count > 0) {
                                var eventtxt = "";
                                for (var i = 0; i < response.count; i++) {
                                    eventtxt += printVariableData(response.variable[i], false) + "<br>";
                                }
                                $("#events").html(eventtxt);
                            } else {
                                $("#events").html(" ");
                                $("#nevents").html("It looks like there is no variables to read.");
                            };
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("do_listVariables:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };


        ///////////////////////////////////////////////////////////////////////
        // do_listVariablesValue
        //

        var do_listVariablesValue = function() {

            if (VscpSessionKey.length > 0) {

                $("#events").html("");

                var txtRegEx = window.prompt("Regular expression (leave blank to select all):", "");
                if (null == txtRegEx) txtRegEx = "(.*)";

                $.ajax({
                    url: VscpServer + '/vscp/rest?vscpsession=' + VscpSessionKey +
                        '&format=jsonp&op=listvar&listlong=true&regex=' + encodeURIComponent(txtRegEx),
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_listVariables");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);
                        console.log("Info = " + response.info);
                        console.log("Count = " + response.count);
                        console.log("Errors = " + response.errors);

                        if (response.success) {
                            if (response.count > 0) {
                                var eventtxt = "";
                                for (var i = 0; i < response.count; i++) {
                                    eventtxt += printVariableData(response.variable[i], true) + "<br>";
                                }
                                $("#events").html(eventtxt);
                            } else {
                                $("#events").html(" ");
                                $("#nevents").html("It looks like there is no variables to read.");
                            };
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("do_listVariables:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

        };


        /*
        	function getQueryParams(qs) {

        		qs = qs.split('+').join(' ');

        		var params = {},
        			tokens,
        			re = /[?&]?([^=]+)=([^&]*)/g;

        		while ( tokens = re.exec( qs ) ) {
        			params[ decodeURIComponent( tokens[ 1 ] ) ] = decodeURIComponent( tokens[ 2 ] );
        		}

        		return params;
        	}

        	var query = getQueryParams( document.location.search );

        	if ( query.host.length > 0 ) {
        		VscpServer = query.host;
        		txtVscpFilter = query.filter;
        		txtVscpMask = query.mask;
        	}
        */
    </script>

</body>

</html>
