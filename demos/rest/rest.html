<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VSCP REST interface demo</title>

    <!-- Don't cache the page -->
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    
    <!-- Navigation bar CSS -->
    <link rel="stylesheet" type="text/css" href="../../css/custom.css">
    
    <!-- Favorite icon -->
    <link rel="icon" href="../../images/favicon.ico">
    
</head>

<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="../index.html">
                    <img src="../../images/logo/vscp_new.png" class="img-thumbnail" width="100" alt="vscp logo" /></a>
            </div>
            <div id="menu">
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <h3>VSCP REST interface demo code</h3>

        <p>
            This demo demonstrates the VSCP daemon REST interface functionality. The VSCP daemon REST interface is documented
            <a href="https://grodansparadis.github.io/vscp-doc-spec/#/./vscp_rest" target="new">here</a> and you can find the code for this example on <a href="https://github.com/grodansparadis/vscp-ux">GitHub.</a>
        </p>
        <p>
            Open a session (Open REST session) and possible define a server (set Server) before you start, to work with the other available menu items.
        </p>
        <p>
            <b>Tip</b> Open the console log window of your browser to see status from this demo as it use log functionality for info about what is done under the hood.
            <p>
                <hr>
                <p id="host">Host: </p>
                <p id="sessionkey">Sessionkey: </p>
                <p id="nevents"> </p>
                <font size="2" color="green">
                    <p id="events"> </p>
                </font>
                <font size="2" color="blue">
                    <p id="log"> </p>
                </font>
                <br /><br />
            </p>
        </p>
        <hr />
        Copyright &copy; 2015-2021 <a href="mailto:vscp@blue-andi.de">Andreas Merkle</a><br />
        Copyright &copy; 2015-2021 <a href="https://www.grodansparadis.com">Ake Hedman, the VSCP Project</a>
    </div>

    <!-- Settings -->
    <script type="text/javascript" src="../../js/settings.js"></script>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- VSCP common core library -->
    <script type="text/javascript" src="../../js/vscp-js/vscp.js"></script>
    <!-- VSCP class definitions -->
    <script type="text/javascript" src="../../js/vscp-js/vscp_class.js"></script>
    <!-- VSCP type definitions -->
    <script type="text/javascript" src="../../js/vscp-js/vscp_type.js"></script>
    <!-- VSCP REST client library -->
    <script type="text/javascript" src="../../js/vscp-js/vscprest.js"></script>

    <!-- Boostrap navigation bar helper functions -->
    <script type="text/javascript" src="../../js/navbar.js"></script>
    
    <!-- Navigation bar menu structure -->
    <script type="text/javascript" src="menu.js"></script>

    <script type="text/javascript">

        var vscpSessionKey = ""; // Session key
        var vscpServer = "http://127.0.0.1:8884"; // Host

        var vscpRestClient = null;

        (function() {
            $(document).ready(function() {

                // Show navigation bar menu
                navBarMenu.show("menu", navBarMenu.content, "../../demos/");

                // Show current server settings
                $("#host").html("<b>Host</b>: " + vscpServer);

            });
        })();

        ///////////////////////////////////////////////////////////////////////
        // do_setServer
        //

        var do_setServer = function() {
            vscpServer = window.prompt("Enter URL for server:", "http://127.0.0.1:8884");
            $("#host").html("<b>Host</b>: " + vscpServer);
        }

        ///////////////////////////////////////////////////////////////////////
        // do_open
        //

        var do_open = function() {

            vscpRestClient = new vscp.rest.Client({
                baseUrl: vscpServer
            });

            vscpRestClient.openSession({
                user: settings.user,
                password: settings.password
            })
            .then(function(data) {
                vscpSessionKey = data.response.vscpsession;
                $("#sessionkey").html("<b>Sessionkey</b>: <font size='2' color='red'>" + data.response.vscpsession + "</font>");
            })
            .catch(function(data) {
                if (null !== data.clientError) {
                    $("#sessionkey").html("<font size='2' color='red'><b>Failed to open</b>: " + data.clientError + "</font>");
                } else if (null !== data.serverError) {
                    $("#sessionkey").html("<font size='2' color='red'><b>Failed to open</b>: " + JSON.stringify(data.serverError) + "</font>");
                } else {
                    $("#sessionkey").html("<font size='2' color='red'><b>Failed to open</b>: Unknown error </font>");
                }
            });

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_close
        //

        var do_close = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.closeSession()
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_close");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#sessionkey").html("<b>Sessionkey</b>: ");
                        $("#nevents").html(" ");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#sessionkey").html("<font size='2' color='red'><b>Failed to close</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#sessionkey").html("<font size='2' color='red'><b>Failed to close</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#sessionkey").html("<font size='2' color='red'><b>Failed to close</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_status
        //

        var do_status = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.getStatus()
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_status");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);
                        console.log("Number of events = " + data.response.nEvents);

                        $("#nevents").html("<b>Number of events in queue</b>: " + data.response.nEvents);
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#nevents").html("<font size='2' color='red'><b>Failed to get status</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#nevents").html("<font size='2' color='red'><b>Failed to get status</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#nevents").html("<font size='2' color='red'><b>Failed to get status</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }
            
            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // printEventData
        //

        var printEventData = function(event) {
            var eventtxt = "<b>Event</b>: <b>Head</b>:" +
                event.vscpHead +
                " <b>DateTime</b>:" + event.vscpDateTime +
                " <b>Timestamp</b>:" + event.vscpTimeStamp +
                " <b>Obid</b>:" + event.vscpObId +
                " <b>Class</b>:" + event.vscpClass +
                " <b>Type</b>:" + event.vscpType +
                " <b>SizeData</b>:" + event.vscpData.length + " <b>Data</b>: ";
            if (0 !== event.vscpData.length) {
                for (var i = 0; i < event.vscpData.length; i++) {
                    eventtxt += event.vscpData[i] + " ";
                }
            } else {
                eventtxt += "none";
            }

            return eventtxt;
        }

        ///////////////////////////////////////////////////////////////////////
        // do_readEventOne
        //

        var do_readEventOne = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.readEvent()
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_readEventOne");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);
                        console.log("Info = " + data.response.info);
                        console.log("Count = " + data.response.count);
                        console.log("Filtered = " + data.response.filtered);
                        console.log("Errors = " + data.response.errors);

                        if (1 === data.response.count) {
                            $("#events").html(printEventData(data.response.event[0]));
                        }
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to read event</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to read event</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#events").html("<font size='2' color='red'><b>Failed to read event</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_readEventAll
        //

        var do_readEventAll = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.readEvent({
                    count: 10000
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_readEventAll");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);
                        console.log("Info = " + data.response.info);
                        console.log("Count = " + data.response.count);
                        console.log("Filtered = " + data.response.filtered);
                        console.log("Errors = " + data.response.errors);

                        if (0 < data.response.count) {
                            var eventtxt = "";
                            for (var i = 0; i < data.response.count; i++) {
                                eventtxt += printEventData(data.response.event[i]) + "<br>";
                            }
                            $("#events").html(eventtxt);
                        } else {
                            $("#events").html(" ");
                            $("#nevents").html("It looks like there is no event to read.");
                        };
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to read event</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to read event</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#events").html("<font size='2' color='red'><b>Failed to read event</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_sendEvent
        //

        var do_sendEvent = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.sendEvent({
                    event: new vscp.Event({
                        vscpClass:      vscp.constants.classes.VSCP_CLASS1_INFORMATION,
                        vscpType:       vscp.constants.types.VSCP_TYPE_INFORMATION_NODE_HEARTBEAT,
                        vscpPriority:   vscp.constants.priorities.PRIORITY_3_NORMAL,
                        vscpData:       [ 138, 0, 255 ]
                    })
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_sendEvent");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#events").html("Event sent.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to send</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to send</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#events").html("<font size='2' color='red'><b>Failed to send</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }
            
            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_setFilter
        //

        var do_setFilter = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.setFilter({
                    filterPriority: 0x0000,
                    filterClass: 0x0014,
                    filterType: 0x0009,
                    maskPriority: 0x0000,
                    maskClass: 0xffff,
                    maskType: 0xffff
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_setFilter");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#events").html("Filter set.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to set filter</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to set filter</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#events").html("<font size='2' color='red'><b>Failed to set filter</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_clrFilter
        //

        var do_clrFilter = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.setFilter({
                    filterPriority: 0x0000,
                    filterClass: 0x0000,
                    filterType: 0x0000,
                    maskPriority: 0x0000,
                    maskClass: 0x0000,
                    maskType: 0x0000
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_clrFilter");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#events").html("Filter cleared.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to clear filter</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to clear filter</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#events").html("<font size='2' color='red'><b>Failed to clear filter</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_clrQueue
        //

        var do_clrQueue = function() {

            if (null !== vscpRestClient) {

                vscpRestClient.clearQueue()
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                         do_clrQueue");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#events").html("Queue cleared.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to clear queue</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#events").html("<font size='2' color='red'><b>Failed to clear queue</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#events").html("<font size='2' color='red'><b>Failed to clear queue</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_sendMeasurement
        //

        var do_sendMeasurement = function() {

            if (vscpSessionKey.length > 0) {

                var txtValue =
                    window.prompt("Send CLASS2.MEASUREMENT_FLOAT. Type=6 (temperature) i degrees Celsius:", "23.98");

                var now = new Date();
                var now_utc = new Date( now.getUTCFullYear(),
                                            now.getUTCMonth(),
                                            now.getUTCDate(),
                                            now.getUTCHours(),
                                            now.getUTCMinutes(),
                                            now.getUTCSeconds(),
                                            now.getMilliseconds() );

                $.ajax({
                    url: vscpServer + '/vscp/rest?vscpsession=' + vscpSessionKey +
                        '&format=jsonp&op=measurement&value=' + txtValue +
                        '&datetime=' + now_utc.toISOString() +
                        '&guid=""' +        // GUID (use GUID of interface)
                        '&type=6' +         // Temperature
                        '&level=2' +        // Level II
                        '&sensoridx=2' +    // Sensor number 2
                        '&unit=1' +         // Unit = 1 Degrees Celsius
                        '&zone=22' +        // Zone = 22
                        '&subzone=33',      // Sub Zone = 33
                    type: "GET",
                    jsonpCallback: 'handler',
                    cache: true,
                    dataType: 'jsonp',
                    success: function(response) {

                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_sendMeasurement");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + response.success);
                        console.log("Code = " + response.code);
                        console.log("Message = " + response.message);
                        console.log("Description = " + response.description);

                        if (response.success) {
                            $("#events").html("OK Variable written");
                        }

                    },
                    error: function(xhr, status, error) {
                        console.log("Close:" + error + " Status:" + status);
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_createVariable
        //

        var do_createVariable = function() {

            if (null !== vscpRestClient) {

                var txtVariableName = window.prompt("Name of variable to create:", "test");
                if (null == txtVariableName) return;
                var txtVariableType = window.prompt("Type:", "string");
                if (null == txtVariableType) return;
                var txtVariableValue = window.prompt("Value:", "This is a new string");
                if (null == txtVariableValue) return;
                var txtVariableNote = window.prompt("Note:", "Just a note about this variable.");
                if (null == txtVariableNote) return;
                var txtVariableAccessRight = window.prompt("Access-rights:", "777");
                if (null == txtVariableAccessRight) return;
                var txtVariablePersistent = window.prompt("Persistent (true/false):", "false");
                if (null == txtVariablePersistent) return;

                vscpRestClient.createVar({
                    name: txtVariableName,
                    type: vscp.getVarTypeNumerical(txtVariableType),
                    accessrights: txtVariableAccessRight,
                    persistency: txtVariablePersistent,
                    value: txtVariableValue,
                    note: txtVariableNote
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_createVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#log").html("OK Variable written.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to create variable</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to create variable</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#log").html("<font size='2' color='red'><b>Failed to create variable</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_readVariable
        //

        var do_readVariable = function() {

            if (null !== vscpRestClient) {

                var txtVariableName = window.prompt("Name of variable to read:", "test");

                vscpRestClient.readVar({
                    name: txtVariableName
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_readVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);
                        console.log("Variable name = " + data.response.varname);
                        console.log("Variable type = " + data.response.vartype);
                        console.log("Variable type code = " + data.response.vartypecode);
                        console.log("Variable percistence = " + data.response.varpersistence);
                        console.log("Variable user = " + data.response.varuser);
                        console.log("Variable access-rights = " + data.response.varaccessright);
                        console.log("Variable last-change = " + data.response.varlastchange);
                        console.log("Variable value = " + data.response.varvalue);
                        console.log("Variable note = " + data.response.varnote);

                        $("#log").html(data.response.varname + " = " + data.response.varvalue +
                                "<br>Type = " + data.response.vartype +
                                "<br>Typecode = " + data.response.vartypecode +
                                "<br>Peristence = " + data.response.varpersistence +
                                "<br>User = " + data.response.varuser +
                                "<br>Access-rights = " + data.response.varaccessright +
                                "<br>Last-change = " + data.response.varlastchange +
                                "<br>Note = " + data.response.varnote);
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to read variable</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to read variable</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#log").html("<font size='2' color='red'><b>Failed to read variable</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_writeVariable
        //

        var do_writeVariable = function() {

            if (null !== vscpRestClient) {

                var txtVariableName = window.prompt("Name of variable to write:", "test");
                var txtVariableType = window.prompt("Type:", "string");
                if (null == txtVariableType) return;
                var txtVariableValue = window.prompt("New value:", "");

                vscpRestClient.writeVar({
                    name: txtVariableName,
                    type: vscp.getVarTypeNumerical(txtVariableType),
                    value: txtVariableValue
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_writeVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#log").html("OK Variable written.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to write variable</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to write variable</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#log").html("<font size='2' color='red'><b>Failed to write variable</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // do_deleteVariable
        //

        var do_deleteVariable = function() {

            if (null !== vscpRestClient) {

                var txtVariableName = window.prompt("Name of variable to delete:", "test");

                vscpRestClient.removeVar({
                    name: txtVariableName
                })
                .then(function(data) {
                        // response will be a JavaScript
                        // array of objects
                        console.log("-----------------------------------------------------------");
                        console.log("                     do_deleteVariable");
                        console.log("-----------------------------------------------------------");
                        console.log("Success = " + data.response.success);
                        console.log("Code = " + data.response.code);
                        console.log("Message = " + data.response.message);
                        console.log("Description = " + data.response.description);

                        $("#log").html("OK Variable deleted.");
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to delete variable</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to delete variable</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#log").html("<font size='2' color='red'><b>Failed to delete variable</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };

        ///////////////////////////////////////////////////////////////////////
        // printVariableData
        //

        var printVariableData = function(variable) {

            var vartxt = "<b>Variable</b>: <b>Name</b>:" + variable.varname +
                " <b>Type</b>:" + variable.vartype +
                " <b>Typecode</b>:" + variable.vartypecode +
                " <b>Persistence</b>:" + variable.varpersistence +
                " <b>User</b>:" + variable.varuser +
                " <b>Access-rights</b>:" + variable.varaccessright +
                " <b>Last-change</b>:" + variable.varlastchange;

            if ("string" === typeof variable.varvalue) {
                vartxt += "<br><b>Value</b>:" + variable.varvalue;
            }

            if ("string" === typeof variable.varnote) {
                vartxt += "<br><b>Note</b>:" + variable.varnote;
            }

            return vartxt;
        }

        ///////////////////////////////////////////////////////////////////////
        // do_listVariables
        //

        var do_listVariables = function() {

            if (null !== vscpRestClient) {

                $("#log").html("");

                var txtRegEx = window.prompt("Regular expression (leave blank to select all):", "");
                if (null == txtRegEx) txtRegEx = "(.*)";

                vscpRestClient.listVar({
                    listLong: false,
                    regex: txtRegEx
                })
                .then(function(data) {
                    var eventtxt = "";
                    var index = 0;

                    // response will be a JavaScript
                    // array of objects
                    console.log("-----------------------------------------------------------");
                    console.log("                     do_listVariables");
                    console.log("-----------------------------------------------------------");
                    console.log("Success = " + data.response.success);
                    console.log("Code = " + data.response.code);
                    console.log("Message = " + data.response.message);
                    console.log("Description = " + data.response.description);
                    console.log("Info = " + data.response.info);
                    console.log("Count = " + data.response.count);
                    console.log("Errors = " + data.response.errors);

                    if (0 < data.response.count) {
                        for (index = 0; index < data.response.count; ++index) {
                            eventtxt += printVariableData(data.response.variable[index]) + "<br>";
                        }
                        $("#log").html(eventtxt);
                    } else {
                        $("#log").html(" ");
                        $("#nevents").html("It looks like there is no variables to read.");
                    };
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to list variables</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to list variables</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#log").html("<font size='2' color='red'><b>Failed to list variables</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };


        ///////////////////////////////////////////////////////////////////////
        // do_listVariablesValue
        //

        var do_listVariablesValue = function() {

            if (null !== vscpRestClient) {

                $("#log").html("");

                var txtRegEx = window.prompt("Regular expression (leave blank to select all):", "");
                if (null == txtRegEx) txtRegEx = "(.*)";

                vscpRestClient.listVar({
                    listLong: true,
                    regex: txtRegEx
                })
                .then(function(data) {
                    var eventtxt = "";
                    var index = 0;

                    // response will be a JavaScript
                    // array of objects
                    console.log("-----------------------------------------------------------");
                    console.log("                     do_listVariablesValue");
                    console.log("-----------------------------------------------------------");
                    console.log("Success = " + data.response.success);
                    console.log("Code = " + data.response.code);
                    console.log("Message = " + data.response.message);
                    console.log("Description = " + data.response.description);
                    console.log("Info = " + data.response.info);
                    console.log("Count = " + data.response.count);
                    console.log("Errors = " + data.response.errors);

                    if (0 < data.response.count) {
                        for (index = 0; index < data.response.count; ++index) {
                            eventtxt += printVariableData(data.response.variable[index]) + "<br>";
                            eventtxt += "-----------------------------------------------------------------------------<br>";
                        }
                        $("#log").html(eventtxt);
                    } else {
                        $("#log").html(" ");
                        $("#nevents").html("It looks like there is no variables to read.");
                    };
                })
                .catch(function(data) {
                    if (null !== data.clientError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to list variables</b>: " + data.clientError + "</font>");
                    } else if (null !== data.serverError) {
                        $("#log").html("<font size='2' color='red'><b>Failed to list variables</b>: " + JSON.stringify(data.serverError) + "</font>");
                    } else {
                        $("#log").html("<font size='2' color='red'><b>Failed to list variables</b>: Unknown error </font>");
                    }
                });
            } else {
                alert("Interface is not open!");
            }

            return;
        };
    </script>

</body>

</html>
